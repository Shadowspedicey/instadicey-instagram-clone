{"version":3,"sources":["state/reducers/isLoading.js","state/reducers/currentUser.js","state/reducers/snackbar.js","state/reducers/newPost.js","state/reducers/index.js","state/index.js","state/actions/currentUser.js","state/actions/snackbar.js","state/actions/newPost.js","assets/namelogo.png","assets/logo.png","assets/misc/loading.jpg","config.js","helpers.js","state/actions/isLoading.js","components/Navbar.js","components/LoadingPage.js","components/AccountAuth/ErrorMsg.js","assets/misc/email-verification.png","components/AccountAuth/SignUpPage.js","assets/misc/green-checkmark.png","components/AccountAuth/PasswordReset.js","assets/misc/lock.png","components/AccountAuth/LoginPage.js","assets/misc/red-x.png","components/AccountAuth/AccountVerification.js","components/AccountEdit/ChangePassword.js","components/AccountEdit/EditProfile.js","components/AccountEdit/AccountEdit.js","components/FollowButton.js","components/VerifiedTick.js","components/FollowWindow.js","components/Posts/Like.js","components/Posts/Comment.js","components/Posts/Save.js","components/Posts/PostWindow.js","components/HomePage.js","components/BrokenPage.js","components/Posts/PostCard.js","components/UserProfile.js","components/Posts/NewPost.js","components/Posts/PostPage.js","components/Inbox/Message.js","components/Inbox/Room.js","assets/misc/send-message.png","components/Inbox/Inbox.js","App.js","index.js"],"names":["isLoading","state","arguments","length","undefined","action","type","currentUser","payload","defaultState","message","severity","open","snackbar","_objectSpread","newPost","file","root","combineReducers","loading","isLoadingReducer","currentUserReducer","snackbarReducer","newPostReducer","store","createStore","rootReducer","window","__REDUX_DEVTOOLS_EXTENSION__","trace","setUser","user","setSnackbar","setNewPost","backend","process","ping","async","fetch","concat","method","mode","ok","_unused","logOut","dispatch","history","localStorage","removeItem","push","refreshOrLogout","result","encodeURIComponent","refreshToken","resultJSON","json","token","claims","jwt","decode","Searchbar","useDispatch","useHistory","setIsLoading","useState","usersCache","setUsersCache","searchResults","setSearchResults","setOpen","inputValue","setInputValue","showRecentSearches","headers","Authorization","status","handleElementClick","username","addToRecentSearches","_jsx","OutsideClickHandler","onOutsideClick","handleOnClose","children","_jsxs","className","placeholder","onFocus","handleOnOpen","onChange","newInput","e","target","value","_unused3","onClick","Error","_unused2","src","Loading","alt","map","option","Link","to","profilePic","style","display","isVerified","title","realName","stopPropagation","preventDefault","newCache","filter","u","removeFromRecentSearches","xmlns","fill","viewBox","d","Navbar","location","useLocation","addPostButton","useRef","useSelector","isDropdownOpen","setIsDropdownOpen","playDropdownClose","setPlayDropdownClose","phoneQuery","useMediaQuery","query","closeDropdown","setTimeout","id","Logo","nameLogo","current","click","accept","ref","input","postPhoto","files","pathname","includes","openDropdown","fillRule","clipRule","fontSize","padding","body","JSON","stringify","email","password","detail","cause","errors","setItem","err","console","error","LoadingPage","ErrorMsg","props","whiteSpace","text","SignUpPage","emailRef","realNameRef","usernameRef","passwordRef","isInfoValid","setInfoValid","emailVerificationTime","setEmailVerificationTime","errorMsg","setErrorMsg","useEffect","document","checkForm","checkEmail","emailValue","trim","match","emailVerificationIcon","fontWeight","color","onSubmit","toLowerCase","info","resultBody","connection","signalR","withUrl","withAutomaticReconnect","build","start","invoke","on","_err$cause","errorMessages","i","code","description","join","PasswordReset","setIsInfoValid","isEmailSent","setIsEmailSent","handleSubmit","encodedEmail","_err$message","greenCheckmark","LoginPage","some","sendEmail","AccountVerification","search","params","URLSearchParams","get","setStatus","confirmPasswordRef","passwordResetDone","setPasswordResetDone","checkPassword","checkConfirmPassword","handleFormSubmitPassword","newPassword","handleLink","handleVerifyEmail","_err$message2","handlePasswordReset","redX","ChangePassword","oldPasswordRef","newPasswordRef","handleOnChange","oldPassword","currentPassword","htmlFor","EditProfile","isEmailValid","setIsEmailValid","isLoadingInfo","setIsLoadingInfo","isLoadingEmail","setIsLoadingEmail","isPhotoLoading","setIsPhotoLoading","isPhotoChangerBoxOpen","setIsPhotoChangerBoxOpen","uploadRef","nameRef","bioRef","openPhotoBox","closePhotoBox","handleChange","updateUserLocally","openPhotoUpload","uploadedPhoto","split","form","FormData","append","bio","realname","defaultValue","AccountEdit","NavLink","exact","activeClassName","Switch","Route","path","component","FollowButton","_ref","isFollowing","setIsFollowing","checkIfFollowing","_err$cause2","VerifiedTick","size","marginLeft","marginRight","width","height","FollowWindow","users","closeFollowListWindow","newMessage","n","person","targetUsername","handleStartChat","startLoading","stopLoading","Like","isComment","isLiked","setIsLiked","likes","checkIfLiked","alert","Comment","commentData","postData","noPhoto","noTimestamp","noLike","noLikesCounter","noRemove","setLikesWindow","refreshComments","createdAtDate","Date","createdAt","paddingRight","comment","format","formatDistanceToNowStrict","Save","isSaved","setIsSaved","savedPosts","savedPostsJSON","p","checkIfSaved","PostWindow","_post$caption","post","isVertical","refreshPost","addComment","fullCommentsFlag","setFullCommentsFlag","commentLoading","setCommentLoading","isDialogBoxOpen","setIsDialogBoxOpen","closeDialogBox","likesWindow","handleAddComment","handleTextareaEnter","keyCode","shiftKey","deletePost","navigator","clipboard","writeText","origin","photo","caption","timestamp","comments","slice","getYear","onKeyDown","HomePage","postsRef","olderPosts","setOlderPosts","postsToDisplay","setPostsToDisplay","threeDaysAgo","setUTCDate","getUTCDate","getPosts","BrokenPage","PostCard","isHovered","setIsHovered","onMouseOver","onMouseLeave","likesCount","commentsCount","position","inset","margin","UserProfile","useParams","userData","setUserData","setSavedPosts","isFollowingListWindowOpen","setIsFollowingListWindowOpen","isFollowersListWindowOpen","setIsFollowersListWindowOpen","savedPostsResult","getItem","savedPostsResultJSON","getUserData","getData","following","followers","posts","foo","createImage","url","Promise","resolve","reject","image","Image","addEventListener","setAttribute","getRadianAngle","degreeValue","Math","PI","getCroppedImg","imageSrc","pixelCrop","rotation","canvas","createElement","ctx","getContext","maxSize","max","safeArea","sqrt","translate","rotate","drawImage","data","getImageData","putImageData","round","x","y","toBlob","NewPost","photoUrl","setPhotoUrl","crop","setCrop","zoom","setZoom","setRotation","croppedAreaPixels","setCroppedAreaPixels","reader","FileReader","readAsDataURL","onloadend","captionRef","getState","cancel","croppedPhoto","formData","name","Cropper","zoomSpeed","onCropChange","onZoomChange","onRotationChange","onCropComplete","croppedArea","aspect","PostPage","postID","setPostData","morePosts","setMorePosts","isSmallScreen","setIsSmallScreen","handleResize","innerWidth","removeEventListener","getPostData","getMorePosts","Message","messageInfo","isSent","Room","roomID","messageRef","roomInfo","setRoomInfo","messages","setMessages","setConnection","signalRConnection","accessTokenFactory","then","msg","prev","catch","statusCode","stop","getRoomInfo","getMessages","alignItems","messagesArray","Inbox","currentUserFollows","setCurrentUserFollows","recentChats","setRecentChats","isNewMessageBoxOpen","setIsNewMessageBoxOpen","closeNewMessageBox","formatDate","date","dateStringArray","followingAndFollowers","Map","values","getUsersFollows","getChats","chatRoom","found","c","sort","a","b","lastUpdated","chat","_chat$lastMessage","lastMessage","_chat$lastMessage2","flexDirection","justifyContent","gap","SendMessage","App","navbarVisibility","setNavbarVisibility","isLoggedIn","handleClose","checkIfLoggedIn","storedToken","refreshTokenInterval","setInterval","clearInterval","paddingTop","Snackbar","autoHideDuration","onClose","anchorOrigin","vertical","horizontal","TransitionComponent","Slide","sx","paddingLeft","Alert","icon","ReactDOM","render","Router","Provider","React","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.a7d8cb67.chunk.js","sourcesContent":["const isLoading = (state = false, action) =>\r\n{\r\n\tswitch (action.type)\r\n\t{\r\n\t\tcase \"START_LOADING\":\r\n\t\t\treturn state = true;\r\n\r\n\t\tcase \"STOP_LOADING\":\r\n\t\t\treturn state = false;\r\n\t\t\t\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n};\r\n\r\nexport default isLoading;\r\n","const currentUser = (state = null, action) =>\r\n{\r\n\tswitch (action.type)\r\n\t{\r\n\t\tcase \"SET_CURRENT_USER\":\r\n\t\t\treturn state = action.payload;\r\n\r\n\t\tcase \"SIGN_OUT\":\r\n\t\t\treturn state = null;\r\n\t\t\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n};\r\n\r\nexport default currentUser;\r\n","const defaultState =\r\n{\r\n\tmessage: \"Empty\", \r\n\tseverity: \"success\",\r\n\topen: false,\r\n};\r\n\r\nconst snackbar = (state = defaultState, action) =>\r\n{\r\n\tswitch (action.type)\r\n\t{\r\n\t\tcase \"SET_SNACKBAR\":\r\n\t\t\treturn state =\r\n\t\t\t{\r\n\t\t\t\tmessage: action.payload.message,\r\n\t\t\t\tseverity: action.payload.severity,\r\n\t\t\t\topen: true,\r\n\t\t\t};\r\n\r\n\t\tcase \"OPEN_SNACKBAR\":\r\n\t\t\treturn state = {...state, open: true};\r\n\r\n\t\tcase \"CLOSE_SNACKBAR\":\r\n\t\t\treturn state = {...state, open: false};\r\n\t\t\t\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n};\r\n\r\nexport default snackbar;\r\n","const newPost = (state = null, action) =>\r\n{\r\n\tswitch (action.type)\r\n\t{\r\n\t\tcase \"SET_NEW_POST\":\r\n\t\t\treturn state = action.payload.file;\r\n\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n};\r\n\r\nexport default newPost;\r\n","import { combineReducers } from \"redux\";\r\nimport isLoadingReducer from \"./isLoading\";\r\nimport currentUserReducer from \"./currentUser\";\r\nimport snackbarReducer from \"./snackbar\";\r\nimport newPostReducer from \"./newPost\";\r\n\r\nconst root = combineReducers(\r\n\t{\r\n\t\tloading: isLoadingReducer,\r\n\t\tcurrentUser: currentUserReducer,\r\n\t\tsnackbar: snackbarReducer,\r\n\t\tnewPost: newPostReducer,\r\n\t}\r\n);\r\n\r\nexport default root;\r\n","import { createStore } from \"redux\";\r\nimport rootReducer from \"./reducers\";\r\n\r\nconst store = createStore(rootReducer, window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__({ trace: true }));\r\n\r\nexport default store;\r\n","export const setUser = user =>\r\n{\r\n\treturn {\r\n\t\ttype: \"SET_CURRENT_USER\",\r\n\t\tpayload: user,\r\n\t};\r\n};\r\n\r\nexport const signOut = () =>\r\n{\r\n\treturn {\r\n\t\ttype: \"SIGN_OUT\",\r\n\t};\r\n};\r\n","export const setSnackbar = (message, severity) =>\r\n{\r\n\treturn {\r\n\t\ttype: \"SET_SNACKBAR\",\r\n\t\tpayload:\r\n\t\t{\r\n\t\t\tmessage,\r\n\t\t\tseverity,\r\n\t\t}\r\n\t};\r\n};\r\n\r\nexport const closeSnackbar = () =>\r\n{\r\n\treturn {\r\n\t\ttype: \"CLOSE_SNACKBAR\",\r\n\t};\r\n};\r\n","export const setNewPost = file =>\r\n{\r\n\treturn {\r\n\t\ttype: \"SET_NEW_POST\",\r\n\t\tpayload:\r\n\t\t{\r\n\t\t\tfile,\r\n\t\t}\r\n\t};\r\n};\r\n","export default __webpack_public_path__ + \"static/media/namelogo.37ef1c08.png\";","export default __webpack_public_path__ + \"static/media/logo.d4e48eb0.png\";","export default __webpack_public_path__ + \"static/media/loading.42aaa181.jpg\";","export const backend = process.env.REACT_APP_BACKEND_URL;","import { backend } from \"./config\";\r\nimport { setUser } from \"./state/actions/currentUser\";\r\nimport { startLoading, stopLoading } from \"./state/actions/isLoading\";\r\nimport jwt from \"jsonwebtoken\";\r\n\r\nexport const ping = async () =>\r\n{\r\n\ttry\r\n\t{\r\n\t\tconst pingResult = await fetch(`${backend}/ping`, {method: \"GET\", mode: \"cors\"});\r\n\t\treturn pingResult.ok;\r\n\t}\r\n\tcatch\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n};\r\n\r\nexport const logOut = async (dispatch, history) => {\r\n\tdispatch(startLoading());\r\n\tlocalStorage.removeItem(\"token\");\r\n\tdispatch(setUser(null));\r\n\thistory.push(\"/\");\r\n\tdispatch(stopLoading());\r\n};\r\n\r\nexport const refreshOrLogout = async (dispatch, history) =>\r\n{\r\n\tconst result = await fetch(`${backend}/auth/login/refresh?rt=${encodeURIComponent(localStorage.refreshToken)}`, {\r\n\t\tmethod: \"POST\"\r\n\t});\r\n\tif (!result.ok)\r\n\t\treturn logOut(dispatch, history);\r\n\tconst resultJSON = await result.json();\r\n\tlocalStorage.token = resultJSON.token;\r\n\tlocalStorage.refreshToken = resultJSON.refreshToken;\r\n\tconst claims = jwt.decode(resultJSON.token);\r\n\tdispatch(setUser(claims));\r\n};","export const startLoading = () =>\r\n{\r\n\treturn {\r\n\t\ttype: \"START_LOADING\",\r\n\t};\r\n};\r\n\r\nexport const stopLoading = () =>\r\n{\r\n\treturn {\r\n\t\ttype: \"STOP_LOADING\",\r\n\t};\r\n};\r\n","import { useRef, useState } from \"react\";\r\nimport { Link, useHistory, useLocation } from \"react-router-dom\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport OutsideClickHandler from \"react-outside-click-handler\";\r\nimport { useMediaQuery } from \"react-responsive\";\r\nimport { setSnackbar } from \"../state/actions/snackbar\";\r\nimport { setNewPost } from \"../state/actions/newPost\";\r\nimport nameLogo from \"../assets/namelogo.png\";\r\nimport Logo from \"../assets/logo.png\";\r\nimport Loading from \"../assets/misc/loading.jpg\";\r\nimport { logOut } from \"../helpers\";\r\nimport { backend } from \"../config\";\r\nimport { startLoading, stopLoading } from \"../state/actions/isLoading\";\r\nimport { setUser } from \"../state/actions/currentUser\";\r\nimport jwt from \"jsonwebtoken\";\r\n\r\nconst Navbar = () =>\r\n{\r\n\tconst history = useHistory();\r\n\tconst location = useLocation();\r\n\tconst dispatch = useDispatch();\r\n\tconst addPostButton = useRef();\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\tconst [isDropdownOpen, setIsDropdownOpen] = useState(false);\r\n\tconst [playDropdownClose, setPlayDropdownClose] = useState(false);\r\n\tconst phoneQuery = useMediaQuery({query: \"(max-width: 600px)\"});\r\n\r\n\tconst handleNewPostChange = input =>\r\n\t{\r\n\t\tconst postPhoto = input.target.files[0];\r\n\t\taddPostButton.current.value = null;\r\n\t\tdispatch(setNewPost(postPhoto));\r\n\t\thistory.push(\"/create/style\");\r\n\t};\r\n\r\n\tconst openDropdown = () => setIsDropdownOpen(true);\r\n\tconst closeDropdown = e =>\r\n\t{\r\n\t\te.stopPropagation();\r\n\t\tsetPlayDropdownClose(true);\r\n\t\tsetTimeout(() => { setIsDropdownOpen(false); setPlayDropdownClose(false); }, 125);\r\n\t};\r\n\r\n\tconst continueAsGuest = async () => {\r\n\t\ttry\r\n\t\t{\r\n\t\t\tdispatch(startLoading());\r\n\r\n\t\t\tconst result = await fetch(`${backend}/auth/login`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\temail: \"guest@instadicey.com\",\r\n\t\t\t\t\tpassword: \"\"\r\n\t\t\t\t}),\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t\"Content-Type\": \"application/json\"\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconst resultJSON = await result.json();\r\n\r\n\t\t\tif (!result.ok)\r\n\t\t\t\tthrow new Error(resultJSON.detail, {cause: resultJSON.errors});\r\n\r\n\t\t\tlocalStorage.setItem(\"token\", resultJSON.token);\r\n\t\t\tlocalStorage.setItem(\"refreshToken\", resultJSON.refreshToken);\r\n\t\t\tconst claims = jwt.decode(resultJSON.token);\r\n\t\t\tdispatch(setUser(claims));\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tconsole.error(err);\r\n\t\t}\r\n\t\tdispatch(stopLoading());\r\n\t};\r\n\r\n\treturn(\r\n\t\t<nav id=\"main-navbar\">\r\n\t\t\t<div className=\"logo\"><Link to=\"/\"><img src={phoneQuery ? Logo : nameLogo} alt=\"Instadicey\"></img></Link></div>\r\n\t\t\t<li><Searchbar/></li>\r\n\t\t\t{ currentUser ?\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t<li><button className=\"add-post icon\" onClick={() => addPostButton.current.click()}><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M13 2v9h9v2h-9v9h-2v-9h-9v-2h9v-9h2zm2-2h-6v9h-9v6h9v9h6v-9h9v-6h-9v-9z\"/></svg></button></li>\r\n\t\t\t\t\t<input accept=\".png, .jpg, .jpeg\" type=\"file\" ref={addPostButton} onChange={handleNewPostChange}></input>\r\n\t\t\t\t\t<li><Link to=\"/\" className=\"icon\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">{location.pathname === \"/\" ? <path d=\"M21 13v10h-6v-6h-6v6h-6v-10h-3l12-12 12 12h-3zm-1-5.907v-5.093h-3v2.093l3 3z\"/> : <path d=\"M20 7.093v-5.093h-3v2.093l3 3zm4 5.907l-12-12-12 12h3v10h7v-5h4v5h7v-10h3zm-5 8h-3v-5h-8v5h-3v-10.26l7-6.912 7 6.99v10.182z\"/>}</svg></Link></li>\r\n\t\t\t\t\t{currentUser.username !== \"guest\" && <li><Link to=\"/direct/inbox\" className=\"icon\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">{location.pathname.includes(\"/direct/\") ? <path d=\"M12 12.713l-11.985-9.713h23.97l-11.985 9.713zm0 2.574l-12-9.725v15.438h24v-15.438l-12 9.725z\"/> : <path d=\"M0 3v18h24v-18h-24zm21.518 2l-9.518 7.713-9.518-7.713h19.036zm-19.518 14v-11.817l10 8.104 10-8.104v11.817h-20z\"/>}</svg></Link></li>}\r\n\t\t\t\t\t<li className=\"profile\" onClick={openDropdown}>\r\n\t\t\t\t\t\t<div className=\"icon\"><img src={currentUser.profilePic} alt=\"Profile Pic\"></img></div>\r\n\t\t\t\t\t\t{ isDropdownOpen &&\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<div className=\"dropdown-container\" onClick={closeDropdown}></div>\r\n\t\t\t\t\t\t\t<div className={`dropdown outlined ${playDropdownClose ? \"closed\" : \"\"}`}>\r\n\t\t\t\t\t\t\t\t<span className=\"arrow\"></span>\r\n\t\t\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\t\t\t<Link to={`/${currentUser.username}`} onClick={closeDropdown}>\r\n\t\t\t\t\t\t\t\t\t\t\t<svg className=\"icon\" xmlns=\"http://www.w3.org/2000/svg\" fillRule=\"evenodd\" clipRule=\"evenodd\"><path d=\"M12 0c6.623 0 12 5.377 12 12s-5.377 12-12 12-12-5.377-12-12 5.377-12 12-12zm8.127 19.41c-.282-.401-.772-.654-1.624-.85-3.848-.906-4.097-1.501-4.352-2.059-.259-.565-.19-1.23.205-1.977 1.726-3.257 2.09-6.024 1.027-7.79-.674-1.119-1.875-1.734-3.383-1.734-1.521 0-2.732.626-3.409 1.763-1.066 1.789-.693 4.544 1.049 7.757.402.742.476 1.406.22 1.974-.265.586-.611 1.19-4.365 2.066-.852.196-1.342.449-1.623.848 2.012 2.207 4.91 3.592 8.128 3.592s6.115-1.385 8.127-3.59zm.65-.782c1.395-1.844 2.223-4.14 2.223-6.628 0-6.071-4.929-11-11-11s-11 4.929-11 11c0 2.487.827 4.783 2.222 6.626.409-.452 1.049-.81 2.049-1.041 2.025-.462 3.376-.836 3.678-1.502.122-.272.061-.628-.188-1.087-1.917-3.535-2.282-6.641-1.03-8.745.853-1.431 2.408-2.251 4.269-2.251 1.845 0 3.391.808 4.24 2.218 1.251 2.079.896 5.195-1 8.774-.245.463-.304.821-.179 1.094.305.668 1.644 1.038 3.667 1.499 1 .23 1.64.59 2.049 1.043z\"/></svg>\r\n\t\t\t\t\t\t\t\t\t\t\tProfile\r\n\t\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\t\t\t<Link to={`/${currentUser.username}/saved`} onClick={closeDropdown}>\r\n\t\t\t\t\t\t\t\t\t\t\t<svg className=\"icon\" xmlns=\"http://www.w3.org/2000/svg\" fillRule=\"evenodd\" clipRule=\"evenodd\"><path d=\"M5 0v24l7-6 7 6v-24h-14zm1 1h12v20.827l-6-5.144-6 5.144v-20.827z\"/></svg>\r\n\t\t\t\t\t\t\t\t\t\t\tSaved\r\n\t\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\t\t\t<Link to=\"/accounts/edit\" onClick={closeDropdown}>\r\n\t\t\t\t\t\t\t\t\t\t\t<svg className=\"icon\" xmlns=\"http://www.w3.org/2000/svg\" fillRule=\"evenodd\" clipRule=\"evenodd\"><path d=\"M12 8.666c-1.838 0-3.333 1.496-3.333 3.334s1.495 3.333 3.333 3.333 3.333-1.495 3.333-3.333-1.495-3.334-3.333-3.334m0 7.667c-2.39 0-4.333-1.943-4.333-4.333s1.943-4.334 4.333-4.334 4.333 1.944 4.333 4.334c0 2.39-1.943 4.333-4.333 4.333m-1.193 6.667h2.386c.379-1.104.668-2.451 2.107-3.05 1.496-.617 2.666.196 3.635.672l1.686-1.688c-.508-1.047-1.266-2.199-.669-3.641.567-1.369 1.739-1.663 3.048-2.099v-2.388c-1.235-.421-2.471-.708-3.047-2.098-.572-1.38.057-2.395.669-3.643l-1.687-1.686c-1.117.547-2.221 1.257-3.642.668-1.374-.571-1.656-1.734-2.1-3.047h-2.386c-.424 1.231-.704 2.468-2.099 3.046-.365.153-.718.226-1.077.226-.843 0-1.539-.392-2.566-.893l-1.687 1.686c.574 1.175 1.251 2.237.669 3.643-.571 1.375-1.734 1.654-3.047 2.098v2.388c1.226.418 2.468.705 3.047 2.098.581 1.403-.075 2.432-.669 3.643l1.687 1.687c1.45-.725 2.355-1.204 3.642-.669 1.378.572 1.655 1.738 2.1 3.047m3.094 1h-3.803c-.681-1.918-.785-2.713-1.773-3.123-1.005-.419-1.731.132-3.466.952l-2.689-2.689c.873-1.837 1.367-2.465.953-3.465-.412-.991-1.192-1.087-3.123-1.773v-3.804c1.906-.678 2.712-.782 3.123-1.773.411-.991-.071-1.613-.953-3.466l2.689-2.688c1.741.828 2.466 1.365 3.465.953.992-.412 1.082-1.185 1.775-3.124h3.802c.682 1.918.788 2.714 1.774 3.123 1.001.416 1.709-.119 3.467-.952l2.687 2.688c-.878 1.847-1.361 2.477-.952 3.465.411.992 1.192 1.087 3.123 1.774v3.805c-1.906.677-2.713.782-3.124 1.773-.403.975.044 1.561.954 3.464l-2.688 2.689c-1.728-.82-2.467-1.37-3.456-.955-.988.41-1.08 1.146-1.785 3.126\"/></svg>\r\n\t\t\t\t\t\t\t\t\t\t\tSettings\r\n\t\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t<li className=\"log-out\" onClick={() => { logOut(dispatch, history); }}>\r\n\t\t\t\t\t\t\t\t\t\tLog Out\r\n\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</li>\r\n\t\t\t\t</ul>\r\n\t\t\t\t:\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<button style={{fontSize: \"1rem\", padding: \"0.5rem 0.75rem\"}} onClick={continueAsGuest}>Continue as guest</button>\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</nav>\r\n\t);\r\n};\r\n\r\nconst Searchbar = () =>\r\n{\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [usersCache, setUsersCache] = useState([]);\r\n\t// An array of users\r\n\tconst [searchResults, setSearchResults] = useState([]);\r\n\tconst [open, setOpen] = useState(false);\r\n\tconst [inputValue, setInputValue] = useState(\"\");\r\n\r\n\tconst addToRecentSearches = async user =>\r\n\t{\r\n\t\tif (!localStorage.token)\r\n\t\t\treturn setUsersCache([user, ...usersCache]);\r\n\r\n\t\tconst result = await fetch(`${backend}/user/add-search/${user.username}`, {\r\n\t\t\tmethod: \"POST\",\r\n\t\t\theaders: {\r\n\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (result.status === 401)\r\n\t\t\treturn logOut(dispatch, history);\r\n\t};\r\n\r\n\tconst showRecentSearches = async () =>\r\n\t{\r\n\t\tif (!localStorage.token)\r\n\t\t\treturn setSearchResults(usersCache);\r\n\t\ttry\r\n\t\t{\r\n\t\t\tsetIsLoading(true);\r\n\t\t\tconst result = await fetch(`${backend}/user/get-search`, {\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\tif (result.ok)\r\n\t\t\t\tsetSearchResults(await result.json());\r\n\t\t\tsetIsLoading(false);\r\n\t\t} catch {\r\n\t\t\tdispatch(setSnackbar(\"Oops, try again later.\", \"error\"));\r\n\t\t}\r\n\t};\r\n\t\r\n\tconst removeFromRecentSearches = async (e, username) =>\r\n\t{\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\tif (!localStorage.token) {\r\n\t\t\tconst newCache = usersCache.filter(u => u.username !== username);\r\n\t\t\tsetSearchResults(newCache);\r\n\t\t\treturn setUsersCache(newCache);\r\n\t\t}\r\n\t\t\r\n\t\tconst result = await fetch(`${backend}/user/remove-search/${username}`, {\r\n\t\t\tmethod: \"POST\",\r\n\t\t\theaders: {\r\n\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (result.status === 401)\r\n\t\t\treturn logOut(dispatch, history);\r\n\r\n\t\tawait showRecentSearches();\r\n\t};\r\n\t\r\n\tconst clearRecentSearches = async () =>\r\n\t{\r\n\t\ttry {\r\n\t\t\tconst result = await fetch(`${backend}/user/clear-search`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\tif (!result.ok)\r\n\t\t\t\tthrow new Error();\r\n\t\t\tsetSearchResults([]);\r\n\t\t} catch {\r\n\t\t\tdispatch(setSnackbar(\"Oops, try again later.\", \"error\"));\r\n\t\t}\r\n\t};\r\n\t\r\n\tconst handleInputChange = async (e) =>\r\n\t{\r\n\t\tconst newInput = e.target.value;\r\n\t\tsetInputValue(newInput);\r\n\t\tif (newInput === \"\") return showRecentSearches();\r\n\t\t\r\n\t\tsetIsLoading(true);\r\n\t\ttry {\r\n\t\t\tconst result = await fetch(`${backend}/user/search?username=${newInput}`);\r\n\t\t\tif (result.ok)\r\n\t\t\t\tsetSearchResults(await result.json());\r\n\t\t} catch {\r\n\t\t\tdispatch(setSnackbar(\"Oops, try again later.\", \"error\"));\r\n\t\t}\r\n\t\tsetIsLoading(false);\r\n\t};\r\n\r\n\tconst handleOnOpen = () =>\r\n\t{\r\n\t\tsetOpen(true);\r\n\t\tif (inputValue !== \"\") return;\r\n\t\tshowRecentSearches();\r\n\t};\r\n\tconst handleOnClose = () => setOpen(false);\r\n\r\n\tconst handleElementClick = user =>\r\n\t{\r\n\t\tsetOpen(false);\r\n\t\tsetInputValue(\"\");\r\n\t\taddToRecentSearches(user);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<OutsideClickHandler onOutsideClick={handleOnClose}>\r\n\t\t\t<div className=\"searchbar-container\">\r\n\t\t\t\t<input \r\n\t\t\t\t\tclassName=\"search\"\r\n\t\t\t\t\tplaceholder=\"Search\"\r\n\t\t\t\t\tonFocus={handleOnOpen}\r\n\t\t\t\t\tonChange={handleInputChange}\r\n\t\t\t\t\tvalue={inputValue}\r\n\t\t\t\t/>\r\n\t\t\t\t{\r\n\t\t\t\t\topen\r\n\t\t\t\t\t\t?\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<span className=\"arrow\"></span>\r\n\t\t\t\t\t\t\t<ul className=\"search-list outlined\">\r\n\t\t\t\t\t\t\t\t{inputValue === \"\" && !isLoading ? <div className=\"recent\">Recent{ localStorage.token && <button className=\"text\" onClick={clearRecentSearches}>Clear All</button> }</div> : null}\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tisLoading\r\n\t\t\t\t\t\t\t\t\t\t? <div className=\"loading\"><img src={Loading} alt=\"loading...\"></img></div>\r\n\t\t\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\t\t\tsearchResults.map(option =>\r\n\t\t\t\t\t\t\t\t\t\t\t(\r\n\t\t\t\t\t\t\t\t\t\t\t\t<li key={option.username}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Link to={`/${option.username}`} onClick={() => handleElementClick(option)}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"img-container outlined round\"><img src={option.profilePic} alt={`${option.username}'s Profile Pic'`}></img></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"info\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div style={{display: \"flex\"}}><span className=\"username\">{option.username}</span> {option.isVerified ? <div className=\"verified\" title=\"Verified\"></div> : null}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"real-name\">{option.realName}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{ inputValue === \"\" && <div className=\"remove\" onClick={e => removeFromRecentSearches(e, option.username)}><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" className=\"bi bi-x-lg\" viewBox=\"0 0 16 16\"><path d=\"M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z\"/></svg></div> }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t\t\t))\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t: null\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</OutsideClickHandler>\r\n\t);\r\n};\r\n\r\nexport default Navbar;\r\n","import Logo from \"../assets/logo.png\";\r\n\r\nconst LoadingPage = () =>\r\n{\r\n\treturn(\r\n\t\t<div className=\"loading-page\">\r\n\t\t\t<div className=\"loading\"><img src={Logo} alt=\"Logo\"></img></div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default LoadingPage;\r\n","const ErrorMsg = props => <div style={{whiteSpace: \"pre-line\"}} className=\"error-msg\">{props.text}</div>;\r\nexport default ErrorMsg;\r\n","export default __webpack_public_path__ + \"static/media/email-verification.ef786c0a.png\";","import { useEffect, useRef, useState } from \"react\";\r\nimport { Link, useHistory } from \"react-router-dom\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { startLoading, stopLoading } from \"../../state/actions/isLoading\";\r\nimport { setUser } from \"../../state/actions/currentUser\";\r\nimport * as signalR from \"@microsoft/signalr\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport ErrorMsg from \"./ErrorMsg\";\r\nimport nameLogo from \"../../assets/namelogo.png\";\r\nimport emailVerificationIcon from \"../../assets/misc/email-verification.png\";\r\nimport { backend } from \"../../config\";\r\nimport { ping } from \"../../helpers\";\r\nimport { setSnackbar } from \"../../state/actions/snackbar\";\r\n\r\nconst SignUpPage = () =>\r\n{\r\n\tconst emailRef = useRef();\r\n\tconst realNameRef = useRef();\r\n\tconst usernameRef = useRef();\r\n\tconst passwordRef = useRef();\r\n\r\n\tconst history = useHistory();\r\n\tconst dispatch = useDispatch();\r\n\r\n\tconst [isInfoValid, setInfoValid] = useState(false);\r\n\tconst [emailVerificationTime, setEmailVerificationTime] = useState(false);\r\n\tconst [errorMsg, setErrorMsg] = useState(null);\r\n\r\n\tuseEffect(() => document.title = \"Sign Up • Instadicey\", []);\r\n\r\n\tconst checkEmail = () =>\r\n\t{\r\n\t\tconst emailValue = emailRef.current.value.trim();\r\n\t\tif (emailValue === \"\") return false;\r\n\t\t// eslint-disable-next-line no-control-regex\r\n\t\telse if (!emailValue.match(/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])/))\r\n\t\t\treturn false;\r\n\t\telse return true;\r\n\t};\r\n\r\n\tconst checkPassword = () => passwordRef.current.value.length < 6 ? false : true;\r\n\r\n\tconst checkUsername = () => usernameRef.current.value.length > 20 || usernameRef.current.value.length === 0 || !usernameRef.current.value.match(/^[A-Za-z0-9]*$/) ? false : true;\r\n\r\n\tconst checkForm = () =>\r\n\t{\r\n\t\tif (checkEmail() && checkPassword() && checkUsername()) setInfoValid(true);\r\n\t\telse setInfoValid(false);\r\n\t};\r\n\r\n\tconst handleSubmit = async  e =>\r\n\t{\r\n\t\tif (!(await ping()))\r\n\t\t{\r\n\t\t\tsetErrorMsg(\"Server is down.\");\r\n\t\t\tdispatch(setSnackbar(\"Server is down.\", \"error\"));\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\te.preventDefault();\r\n\t\tif (!isInfoValid) return;\r\n\t\tsetErrorMsg(null);\r\n\t\t\r\n\t\tconst email = emailRef.current.value.toLowerCase();\r\n\t\tconst realName = realNameRef.current.value;\r\n\t\tconst username = usernameRef.current.value.toLowerCase();\r\n\t\tconst password = passwordRef.current.value;\r\n\t\t\r\n\t\ttry\r\n\t\t{\r\n\t\t\tdispatch(startLoading());\r\n\r\n\t\t\tconst info = { email, username, realName, password };\r\n\t\t\tconst result = await fetch(`${backend}/auth/register`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tbody: JSON.stringify(info),\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t\"Content-Type\": \"application/json\"\r\n\t\t\t\t},\r\n\t\t\t\tmode: \"cors\"\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif (!result.ok) {\r\n\t\t\t\tconst resultBody = await result.json();\r\n\t\t\t\tthrow new Error(resultBody.detail, {cause: resultBody.errors});\r\n\t\t\t}\r\n\t\t\tsetEmailVerificationTime(true);\r\n\r\n\t\t\tconst connection = new signalR.HubConnectionBuilder().withUrl(`${backend}/email-verification-hub`).withAutomaticReconnect().build();\r\n\t\t\tawait connection.start();\r\n\t\t\tawait connection.invoke(\"RegisterUserWithEmail\", email);\r\n\t\t\tconnection.on(\"VerifyEmail\", async () => {\r\n\t\t\t\tdispatch(startLoading());\r\n\t\t\t\t// Log in\r\n\t\t\t\tconst result = await fetch(`${backend}/auth/login`, {\r\n\t\t\t\t\tmethod: \"POST\",\r\n\t\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\t\temail,\r\n\t\t\t\t\t\tpassword\r\n\t\t\t\t\t}),\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t\"Content-Type\": \"application/json\"\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (result.ok) {\r\n\t\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\t\tlocalStorage.setItem(\"token\", resultJSON.token);\r\n\t\t\t\t\tlocalStorage.setItem(\"refreshToken\", resultJSON.refreshToken);\r\n\t\t\t\t\tconst claims = jwt.decode(resultJSON.token);\r\n\t\t\t\t\tdispatch(setUser(claims));\r\n\t\t\t\t}\r\n\t\t\t\thistory.push(\"/\");\r\n\t\t\t\tdispatch(stopLoading());\r\n\t\t\t});\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tconst errors = err.cause ?? [];\r\n\t\t\tconst errorMessages = [];\r\n\t\t\tfor (var i = 0; i < errors.length; i++)\r\n\t\t\t\tif (errors[i].code === \"DuplicateUserName\")\r\n\t\t\t\t\terrorMessages.push(\"Username already in use.\");\r\n\t\t\t\telse if (errors[i].code === \"DuplicateEmail\")\r\n\t\t\t\t\terrorMessages.push(\"Email already in use.\");\r\n\t\t\t\telse\r\n\t\t\t\t\terrorMessages.push(errors[i].description);\r\n\t\t\terrors.length === 0\r\n\t\t\t\t? setErrorMsg(\"An error has occurred.\")\r\n\t\t\t\t: setErrorMsg(errorMessages.join(\"\\n\"));\r\n\r\n\t\t}\r\n\t\tdispatch(stopLoading());\r\n\t};\r\n\r\n\tuseEffect(() => dispatch(stopLoading()), [dispatch]);\r\n\r\n\tif (!emailVerificationTime)\r\n\t\treturn(\r\n\t\t\t<div id=\"signup-page\">\r\n\t\t\t\t<div id=\"signup-window\" className=\"outlined\">\r\n\t\t\t\t\t<div className=\"logo\"><img src={nameLogo} alt=\"Instadicey logo\"></img></div>\r\n\t\t\t\t\t{ \r\n\t\t\t\t\t\terrorMsg \r\n\t\t\t\t\t\t\t? <ErrorMsg text={errorMsg}/>\r\n\t\t\t\t\t\t\t: <span style={{fontWeight: \"bold\", color: \"rgba(50, 50, 50, 0.5)\"}}>Sign up now!</span> \r\n\t\t\t\t\t}\r\n\t\t\t\t\t<form className=\"info\" onSubmit={handleSubmit}>\r\n\t\t\t\t\t\t<input type=\"text\" placeholder=\"Email\" id=\"email\" ref={emailRef} onChange={checkForm}></input>\r\n\t\t\t\t\t\t<input type=\"text\" placeholder=\"Full Name\" id=\"name\" ref={realNameRef}></input>\r\n\t\t\t\t\t\t<input type=\"text\" placeholder=\"Username\" id=\"username\" ref={usernameRef} onChange={checkForm}></input>\r\n\t\t\t\t\t\t<input type=\"password\" placeholder=\"Password\" id=\"password\" ref={passwordRef} onChange={checkForm}></input>\r\n\t\t\t\t\t\t<button id=\"signup\" className={`${isInfoValid ? null : \"disabled\"}`} type=\"submit\">Sign Up</button>\r\n\t\t\t\t\t</form>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"extra outlined\"><span>Have an account? <Link to=\"/\" className=\"button\">Log In</Link></span></div>\r\n\t\t\t</div>\r\n\t\t);\r\n\telse\r\n\t\treturn(\r\n\t\t\t<div id=\"email-verification-window\" className=\"outlined\">\r\n\t\t\t\t<div className=\"icon\"><img src={emailVerificationIcon} alt=\"email verification icon\"></img></div>\r\n\t\t\t\t<p className=\"header\">A verification link has been sent to your email</p>\r\n\t\t\t\t<p>Please click on the link sent to your email address and come back here to continue.</p>\r\n\t\t\t</div>\r\n\t\t);\r\n};\r\n\r\nexport default SignUpPage;\r\n","export default __webpack_public_path__ + \"static/media/green-checkmark.6fb350c8.png\";","import { useEffect, useRef, useState } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport ErrorMsg from \"./ErrorMsg\";\r\nimport Lock from \"../../assets/misc/lock.png\";\r\nimport greenCheckmark from \"../../assets/misc/green-checkmark.png\";\r\nimport { setUser } from \"../../state/actions/currentUser\";\r\nimport { backend } from \"../../config\";\r\nimport { startLoading, stopLoading } from \"../../state/actions/isLoading\";\r\n\r\nconst PasswordReset = () =>\r\n{\r\n\tconst dispatch = useDispatch();\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\tconst emailRef = useRef();\r\n\tconst [isInfoValid, setIsInfoValid] = useState(false);\r\n\tconst [isEmailSent, setIsEmailSent] = useState(false);\r\n\tconst [errorMsg, setErrorMsg] = useState(null);\r\n\r\n\tuseEffect(() => document.title = \"Reset Password • Instadicey\", []);\r\n\tuseEffect(() => {\r\n\t\tlocalStorage.removeItem(\"token\");\r\n\t\tdispatch(setUser(null));\r\n\t}, [dispatch]);\r\n\r\n\tconst checkEmail = () =>\r\n\t{\r\n\t\tconst emailValue = emailRef.current.value;\r\n\t\tif (emailValue === \"\") return setIsInfoValid(false);\r\n\t\t// eslint-disable-next-line no-control-regex\r\n\t\telse if (!emailValue.match(/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])/))\r\n\t\t\treturn setIsInfoValid(false);\r\n\t\telse return setIsInfoValid(true);\r\n\t};\r\n\r\n\tconst handleSubmit = async e => {\r\n\t\te.preventDefault();\r\n\t\tif (!isInfoValid) return;\r\n\r\n\t\tconst email = emailRef.current.value;\r\n\t\tdispatch(startLoading());\r\n\t\ttry {\r\n\t\t\tsetErrorMsg(null);\r\n\t\t\tconst encodedEmail = encodeURIComponent(email);\r\n\t\t\tconst result = await fetch(`${backend}/auth/send-password-reset?email=${encodedEmail}`, {\r\n\t\t\t\tmethod: \"POST\"\r\n\t\t\t});\r\n\t\t\tif (!result.ok) {\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail);\r\n\t\t\t}\r\n\t\t\tsetIsEmailSent(true);\r\n\t\t} catch (err) {\r\n\t\t\tsetErrorMsg(err.message ?? \"An error occurred\");\r\n\t\t}\r\n\t\tdispatch(stopLoading());\r\n\t};\r\n\r\n\tif (isEmailSent)\r\n\t{\r\n\t\treturn(\r\n\t\t\t<div className=\"password-reset-window success outlined\">\r\n\t\t\t\t<div className=\"icon\"><img src={greenCheckmark} alt=\"Success\"></img></div>\r\n\t\t\t\t<h1>Email sent</h1>\r\n\t\t\t\t<p>Check your inbox and spam and follow the instructions</p>\r\n\t\t\t\t<div className=\"extra\">\r\n\t\t\t\t\t<Link to=\"/\">Back To Login</Link>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t} else\r\n\t{\r\n\t\treturn(\r\n\t\t\t<div className=\"password-reset-window outlined\">\r\n\t\t\t\t<div className=\"icon\"><img src={Lock} alt=\"locked out\"></img></div>\r\n\t\t\t\t<h1>Can't Log In?</h1>\r\n\t\t\t\t<p>It's all good, mate. just enter your email and we'll send you an email to reset your password right away!</p>\r\n\t\t\t\t{ errorMsg ? <ErrorMsg text={errorMsg}/> : null }\r\n\t\t\t\t<form onSubmit={handleSubmit}>\r\n\t\t\t\t\t<input type=\"text\" id=\"email\" placeholder=\"Email\" ref={emailRef} onChange={checkEmail}></input>\r\n\t\t\t\t\t<button id=\"reset\" className={`${isInfoValid ? null : \"disabled\"}`}>Send Email</button>\r\n\t\t\t\t</form>\r\n\t\t\t\t{ !currentUser &&\r\n\t\t\t\t\t<div className=\"extra outlined\">\r\n\t\t\t\t\t\t<Link to=\"/\">Back To Login</Link>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n};\r\n\r\nexport default PasswordReset;\r\n","export default \"data:image/png;base64,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\"","import { useState, useRef, useEffect } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { startLoading, stopLoading } from \"../../state/actions/isLoading\";\r\nimport { setUser } from \"../../state/actions/currentUser\";\r\nimport ErrorMsg from \"./ErrorMsg\";\r\nimport nameLogo from \"../../assets/namelogo.png\";\r\nimport {ping} from \"../../helpers.js\";\r\nimport \"./auth.css\";\r\nimport { backend } from \"../../config.js\";\r\nimport jwt from \"jsonwebtoken\";\r\n\r\nconst LoginPage = () =>\r\n{\r\n\tconst emailRef = useRef();\r\n\tconst passwordRef = useRef();\r\n\tconst dispatch = useDispatch();\r\n\r\n\tconst [isInfoValid, setInfoValid] = useState(false);\r\n\tconst [errorMsg, setErrorMsg] = useState(null);\r\n\r\n\tuseEffect(() => document.title = \"Login • Instadicey\", []);\r\n\r\n\tconst checkEmail = () =>\r\n\t{\r\n\t\tconst emailValue = emailRef.current.value;\r\n\t\tif (emailValue === \"\") return false;\r\n\t\t// eslint-disable-next-line no-control-regex\r\n\t\telse if (!emailValue.match(/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])/))\r\n\t\t\treturn false;\r\n\t\telse return true;\r\n\t};\r\n\r\n\tconst checkPassword = () =>\r\n\t{\r\n\t\tconst passwordValue = passwordRef.current.value;\r\n\t\treturn passwordValue.length < 6 ? false : true;\r\n\t};\r\n\r\n\tconst checkForm = () =>\r\n\t{\r\n\t\tif (checkEmail() && checkPassword()) setInfoValid(true);\r\n\t\telse setInfoValid(false);\r\n\t};\r\n\r\n\tconst handleSubmit = async  e =>\r\n\t{\r\n\t\te.preventDefault();\r\n\t\tif (!isInfoValid) return;\r\n\r\n\t\tconst email = emailRef.current.value;\r\n\t\tconst password = passwordRef.current.value;\r\n\r\n\t\ttry\r\n\t\t{\r\n\t\t\tdispatch(startLoading());\r\n\r\n\t\t\tif (!(await ping())) {\r\n\t\t\t\tsetErrorMsg(\"Server is down.\");\r\n\t\t\t\treturn dispatch(stopLoading());\r\n\t\t\t}\r\n\r\n\t\t\tconst result = await fetch(`${backend}/auth/login`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\temail,\r\n\t\t\t\t\tpassword\r\n\t\t\t\t}),\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t\"Content-Type\": \"application/json\"\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconst resultJSON = await result.json();\r\n\r\n\t\t\tif (!result.ok)\r\n\t\t\t\tthrow new Error(resultJSON.detail, {cause: resultJSON.errors});\r\n\r\n\t\t\tlocalStorage.setItem(\"token\", resultJSON.token);\r\n\t\t\tlocalStorage.setItem(\"refreshToken\", resultJSON.refreshToken);\r\n\t\t\tconst claims = jwt.decode(resultJSON.token);\r\n\t\t\tdispatch(setUser(claims));\r\n\r\n\t\t\tdispatch(stopLoading());\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tconst errors = err.cause ?? [];\r\n\t\t\tif (errors.some(e => e.code === \"UserNotFound\"))\r\n\t\t\t\tsetErrorMsg(e.description);\r\n\t\t\telse if (errors.some(e => e.code === \"EmailNotVerified\")) {\r\n\t\t\t\tconst sendEmail = async () =>\r\n\t\t\t\t{\r\n\t\t\t\t\tawait fetch(`${backend}/auth/send-email-verification?email=${encodeURIComponent(email)}`, {method: \"POST\"});\r\n\t\t\t\t\tsetErrorMsg(\"Email sent\");\r\n\t\t\t\t};\r\n\t\t\t\tsetErrorMsg(<div>Email not verified<br/><span className=\"link\" onClick={sendEmail}>click here</span> to send verification email</div>);\r\n\t\t\t} else\r\n\t\t\t\tsetErrorMsg(err.message);\r\n\r\n\t\t\tdispatch(stopLoading());\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() => dispatch(stopLoading()), [dispatch]);\r\n\r\n\treturn(\r\n\t\t<div id=\"login-page\">\r\n\t\t\t<div id=\"login-window\" className=\"outlined\">\r\n\t\t\t\t<div className=\"logo\"><img src={nameLogo} alt=\"Instadicey logo\"></img></div>\r\n\t\t\t\t{ errorMsg ? <ErrorMsg text={errorMsg}/> : null }\r\n\t\t\t\t<form className=\"info\" onSubmit={handleSubmit}>\r\n\t\t\t\t\t<input type=\"text\" placeholder=\"Email\" id=\"email\" ref={emailRef} onChange={checkForm}></input>\r\n\t\t\t\t\t<input type=\"password\" placeholder=\"Password\" id=\"password\" ref={passwordRef} onChange={checkForm}></input>\r\n\t\t\t\t\t<button id=\"login\" className={`${isInfoValid ? null : \"disabled\"}`}>Log In</button>\r\n\t\t\t\t</form>\r\n\t\t\t\t<Link to=\"/accounts/password/reset\">Forgot password?</Link>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"extra outlined\"><span>Don't have an account? <Link to=\"/accounts/email-signup\" className=\"button\">Sign Up</Link></span></div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default LoginPage;\r\n","export default __webpack_public_path__ + \"static/media/red-x.1684dcf4.png\";","/* eslint-disable react-hooks/exhaustive-deps */\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { startLoading, stopLoading } from \"../../state/actions/isLoading\";\r\nimport Logo from \"../../assets/logo.png\";\r\nimport greenCheckmark from \"../../assets/misc/green-checkmark.png\";\r\nimport redX from \"../../assets/misc/red-x.png\";\r\nimport { backend } from \"../../config\";\r\nimport { useHistory, useLocation } from \"react-router-dom/cjs/react-router-dom.min\";\r\nimport { logOut, refreshOrLogout } from \"../../helpers\";\r\n\r\nconst AccountVerification = () =>\r\n{\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\tconst {search} = useLocation();\r\n\tconst params = new URLSearchParams(search);\r\n\tconst mode = params.get(\"mode\");\r\n\tconst email = params.get(\"user\");\r\n\tconst token = params.get(\"token\");\r\n\tconst [errorMsg, setErrorMsg] = useState(\"\");\r\n\tconst [status, setStatus] = useState({});\r\n\r\n\tconst passwordRef = useRef();\r\n\tconst confirmPasswordRef = useRef();\r\n\tconst [passwordResetDone, setPasswordResetDone] = useState(false);\r\n\tconst [isInfoValid, setIsInfoValid] = useState(false);\r\n\r\n\tuseEffect(() => document.title = \"Verification • Instadicey\", []);\r\n\r\n\tconst handleVerifyEmail = async () =>\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tif (!email || !token)\r\n\t\t\t\tthrow new Error(\"Email or token missing.\");\r\n\t\t\tvar result;\r\n\t\t\tif (localStorage.token) {\r\n\t\t\t\tresult = await fetch(`${backend}/auth/confirm-email-change?newEmail=${encodeURIComponent(email)}&code=${encodeURIComponent(token)}`, {\r\n\t\t\t\t\tmethod: \"POST\",\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (result.status === 401)\r\n\t\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\t\tawait refreshOrLogout(dispatch, history);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tresult = await fetch(`${backend}/auth/confirm-email?encodedEmail=${encodeURIComponent(email)}&code=${encodeURIComponent(token)}`, {method: \"POST\"});\r\n\t\t\tif (!result.ok) {\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail, {cause: resultJSON.errors});\r\n\t\t\t}\r\n\t\t\tsetStatus({\r\n\t\t\t\ttype: \"email-verification\",\r\n\t\t\t\tok: true,\r\n\t\t\t});\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tif (err.message.includes(\"Failed to fetch\"))\r\n\t\t\t\tsetErrorMsg(\"Server is down.\");\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tconst errors = err.cause;\r\n\t\t\t\tif (!email || !token)\r\n\t\t\t\t\tsetErrorMsg(\"Email or token missing.\");\r\n\t\t\t\telse if (errors.length)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (errors.some(e => e.code === \"NotFound\"))\r\n\t\t\t\t\t\tsetErrorMsg(err.message);\r\n\t\t\t\t\telse if (errors.some(e => e.code === \"InvalidToken\"))\r\n\t\t\t\t\t\tsetErrorMsg(err.message);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\tsetErrorMsg(\"An error has occurred.\");\t\r\n\t\t\t}\r\n\t\t\tsetStatus({\r\n\t\t\t\ttype: \"email-verification\",\r\n\t\t\t\tok: false,\r\n\t\t\t});\r\n\t\t}\r\n\t\tdispatch(stopLoading());\r\n\t};\r\n\r\n\tconst checkForm = () => checkPassword() && checkConfirmPassword() ? setIsInfoValid(true) : setIsInfoValid(false);\r\n\tconst checkPassword = () => passwordRef.current.value.length < 6 ? false : true;\r\n\tconst checkConfirmPassword = () => confirmPasswordRef.current.value === passwordRef.current.value ? true : false;\r\n\tconst handleFormSubmitPassword = async e =>\r\n\t{\r\n\t\te.preventDefault();\r\n\t\tif (!isInfoValid) return;\r\n\r\n\t\tconst newPassword = passwordRef.current.value;\r\n\t\ttry\r\n\t\t{\r\n\t\t\tconst result = await fetch(`${backend}/auth/password-reset`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t\"Content-Type\": \"application/json\"\r\n\t\t\t\t},\r\n\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\temail,\r\n\t\t\t\t\tnewPassword,\r\n\t\t\t\t\ttoken\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\tif (!result.ok) {\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail);\r\n\t\t\t}\r\n\t\t\tsetPasswordResetDone(true);\r\n\t\t\tsetStatus({\r\n\t\t\t\ttype: \"password-reset\",\r\n\t\t\t\tok: true,\r\n\t\t\t});\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tsetErrorMsg(err.message ?? \"An error occurred. Please, try again later.\");\r\n\t\t\tsetStatus({\r\n\t\t\t\ttype: \"password-reset\",\r\n\t\t\t\tok: false,\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tconst handlePasswordReset = async () =>\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tif (!email || !token)\r\n\t\t\t\tthrow new Error(\"Email or token missing.\");\r\n\t\t\t\r\n\t\t\tconst tokenCheckResult = await fetch(`${backend}/auth/check-password-reset-token?email=${encodeURIComponent(email)}&token=${encodeURIComponent(token)}`, { method: \"POST\" });\r\n\t\t\tif (!tokenCheckResult.ok) throw new Error(\"Token is invalid or user was not found.\");\r\n\t\t} catch (err) {\r\n\t\t\tsetStatus({\r\n\t\t\t\ttype: \"password-reset\",\r\n\t\t\t\tok: false,\r\n\t\t\t});\r\n\t\t\tsetErrorMsg(err.message ?? \"Please try to reset the password again.\");\r\n\t\t}\r\n\t\tdispatch(stopLoading());\r\n\t};\r\n\r\n\tconst handleLink = async () =>\r\n\t{\r\n\t\tswitch (mode)\r\n\t\t{\r\n\t\t\tcase \"verifyEmail\":\r\n\t\t\t\tawait handleVerifyEmail();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"resetPassword\":\r\n\t\t\t\tawait handlePasswordReset();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tdispatch(startLoading());\r\n\t\thandleLink();\r\n\t}, [mode]);\r\n\r\n\r\n\tif (mode === \"resetPassword\" && !passwordResetDone && status.ok !== false)\r\n\t{\r\n\t\treturn(\r\n\t\t\t<div className=\"verification-window outlined password-reset\">\r\n\t\t\t\t<div className=\"icon\"><img src={Logo} alt=\"logo\"></img></div>\r\n\t\t\t\t<div className=\"email-div\">\r\n\t\t\t\t\t<h2>Your Email:</h2>\r\n\t\t\t\t\t<span>{email}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<form onSubmit={handleFormSubmitPassword}>\r\n\t\t\t\t\t<input type=\"password\" id=\"password\" placeholder=\"Password (at least 6 characters)\" ref={passwordRef} onChange={checkForm}></input>\r\n\t\t\t\t\t<input type=\"password\" id=\"confirm password\" placeholder=\"Confirm Password\" ref={confirmPasswordRef} onChange={checkForm}></input>\r\n\t\t\t\t\t<button className={`${isInfoValid ? null : \"disabled\"}`}>Reset Password</button>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t);\r\n\t} else if (status.ok)\r\n\t{\r\n\t\treturn(\r\n\t\t\t<div className=\"verification-window success outlined\">\r\n\t\t\t\t<div className=\"icon\"><img src={greenCheckmark} alt=\"success\"></img></div>\r\n\t\t\t\t{\r\n\t\t\t\t\tstatus.type === \"email-verification\"\r\n\t\t\t\t\t\t? \r\n\t\t\t\t\t\t<div className=\"text-div\">\r\n\t\t\t\t\t\t\t<h1>Your email address has been verified</h1>\r\n\t\t\t\t\t\t\t<p>Please go back to the sign up page to continue.</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t: status.type === \"password-reset\"\r\n\t\t\t\t\t\t\t?\r\n\t\t\t\t\t\t\t<div className=\"text-div\">\r\n\t\t\t\t\t\t\t\t<h1>Your password has been reset</h1>\r\n\t\t\t\t\t\t\t\t<p>You can now log in with the new password.</p>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t: null\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t);\r\n\t} else if (status.ok === false)\r\n\t{\r\n\t\treturn(\r\n\t\t\t<div className=\"verification-window failed outlined\">\r\n\t\t\t\t<div className=\"icon\"><img src={redX} alt=\"failed\"></img></div>\r\n\t\t\t\t{\r\n\t\t\t\t\tstatus.type === \"email-verification\"\r\n\t\t\t\t\t\t? \r\n\t\t\t\t\t\t<div className=\"text-div\">\r\n\t\t\t\t\t\t\t<h1>An error has occured</h1>\r\n\t\t\t\t\t\t\t<p>{errorMsg}</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t: status.type === \"password-reset\"\r\n\t\t\t\t\t\t\t?\r\n\t\t\t\t\t\t\t<div className=\"text-div\">\r\n\t\t\t\t\t\t\t\t<h1>An error has occured</h1>\r\n\t\t\t\t\t\t\t\t<p>{errorMsg}</p>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t: null\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\telse return null;\r\n};\r\n\r\nexport default AccountVerification;\r\n","import { useRef, useState } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { backend } from \"../../config.js\";\r\nimport { logOut } from \"../../helpers.js\";\r\nimport LoadingPage from \"../LoadingPage\";\r\nimport { setSnackbar } from \"../../state/actions/snackbar\";\r\nimport Loading from \"../../assets/misc/loading.jpg\";\r\nimport { useHistory } from \"react-router-dom/cjs/react-router-dom.min\";\r\n\r\nconst ChangePassword = () =>\r\n{\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\tconst [isInfoValid, setIsInfoValid] = useState(null);\r\n\tconst [isLoading, setIsLoading] = useState(null);\r\n\r\n\tconst oldPasswordRef = useRef();\r\n\tconst newPasswordRef = useRef();\r\n\tconst confirmPasswordRef = useRef();\r\n\r\n\tconst handleOnChange = () =>\r\n\t\toldPasswordRef.current.value.length > 0\r\n\t\t&& newPasswordRef.current.value.length > 0\r\n\t\t&& confirmPasswordRef.current.value.length > 0\r\n\t\t\t?\tsetIsInfoValid(true)\r\n\t\t\t: setIsInfoValid(false);\r\n\r\n\tconst handleSubmit = async e =>\r\n\t{\r\n\t\te.preventDefault();\r\n\t\tif (!isInfoValid) return;\r\n\t\t\r\n\t\ttry\r\n\t\t{\r\n\t\t\tsetIsLoading(true);\r\n\t\t\tconst oldPassword = oldPasswordRef.current.value;\r\n\t\t\tconst newPassword = newPasswordRef.current.value;\r\n\t\t\tconst confirmPassword = confirmPasswordRef.current.value;\r\n\t\t\tif (newPassword !== confirmPassword) throw new Error(\"Password don't match\");\r\n\t\t\tif (newPassword.length < 6) throw new Error(\"Password too short\");\r\n\r\n\t\t\tconst result = await fetch(`${backend}/auth/change-password`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`,\r\n\t\t\t\t\t\"Content-Type\": \"application/json\"\r\n\t\t\t\t},\r\n\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\tcurrentPassword: oldPassword,\r\n\t\t\t\t\tnewPassword: newPassword\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\tif (!result.ok) {\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail);\r\n\t\t\t}\r\n\t\t\tdispatch(setSnackbar(\"Password updated successfully.\", \"success\"));\r\n\t\t} catch(err)\r\n\t\t{\r\n\t\t\tdispatch(setSnackbar(err.message ?? \"Oops, please try again later.\", \"error\"));\r\n\t\t}\r\n\t\toldPasswordRef.current.value = \"\";\r\n\t\tnewPasswordRef.current.value = \"\";\r\n\t\tconfirmPasswordRef.current.value = \"\";\r\n\t\tsetIsLoading(false);\r\n\t};\r\n\r\n\tif (!currentUser) return <LoadingPage/>;\r\n\treturn(\r\n\t\t<div className=\"account-element change-password\">\r\n\t\t\t<div className=\"element profile-pic-container\">\r\n\t\t\t\t<div className=\"img-container outlined left\">\r\n\t\t\t\t\t<img src={currentUser.profilePic} alt={`${currentUser.username}'s profile pic'`}></img>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"right\">\r\n\t\t\t\t\t{currentUser.username}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<form onSubmit={handleSubmit}>\r\n\t\t\t\t<div className=\"element\">\r\n\t\t\t\t\t<div className=\"left\">\r\n\t\t\t\t\t\t<label htmlFor=\"old-password\">Old Password</label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"right\">\r\n\t\t\t\t\t\t<input type=\"password\" id=\"old-password\" className=\"outlined\" ref={oldPasswordRef} onChange={handleOnChange}></input>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"element\">\r\n\t\t\t\t\t<div className=\"left\">\r\n\t\t\t\t\t\t<label htmlFor=\"new-password\">New Password</label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"right\">\r\n\t\t\t\t\t\t<input type=\"password\" id=\"new-password\" className=\"outlined\" ref={newPasswordRef} onChange={handleOnChange}></input>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"element\">\r\n\t\t\t\t\t<div className=\"left\">\r\n\t\t\t\t\t\t<label htmlFor=\"confirm-password\">Confirm New Password</label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"right\">\r\n\t\t\t\t\t\t<input type=\"password\" id=\"confirm-password\" className=\"outlined\" ref={confirmPasswordRef} onChange={handleOnChange}></input>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"element\">\r\n\t\t\t\t\t<div className=\"left\"></div>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tisLoading\r\n\t\t\t\t\t\t\t? <button className=\"loading\"><div><img src={Loading} alt=\"loading\"></img></div></button>\r\n\t\t\t\t\t\t\t: <button className={`submit ${isInfoValid ? null : \"disabled\"}`}>Change Password</button>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"element\">\r\n\t\t\t\t\t<div className=\"left\"></div>\r\n\t\t\t\t\t<Link to=\"/accounts/password/reset\" className=\"forgot-password\">Forgot Password?</Link>\r\n\t\t\t\t</div>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default ChangePassword;\r\n","import { useRef, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { setSnackbar } from \"../../state/actions/snackbar\";\r\nimport LoadingPage from \"../LoadingPage\";\r\nimport Loading from \"../../assets/misc/loading.jpg\";\r\nimport { backend } from \"../../config\";\r\nimport { logOut, refreshOrLogout } from \"../../helpers\";\r\nimport { useHistory } from \"react-router-dom/cjs/react-router-dom.min\";\r\n\r\nconst EditProfile = () =>\r\n{\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\tconst [isInfoValid, setIsInfoValid] = useState(false);\r\n\tconst [isEmailValid, setIsEmailValid] = useState(false);\r\n\tconst [isLoadingInfo, setIsLoadingInfo] = useState(false);\r\n\tconst [isLoadingEmail, setIsLoadingEmail] = useState(false);\r\n\tconst [isPhotoLoading, setIsPhotoLoading] = useState(false);\r\n\tconst [isPhotoChangerBoxOpen, setIsPhotoChangerBoxOpen] = useState(false);\r\n\r\n\tconst uploadRef = useRef();\r\n\tconst nameRef = useRef();\r\n\tconst usernameRef = useRef();\r\n\tconst bioRef = useRef();\r\n\tconst emailRef = useRef();\r\n\tconst confirmPasswordRef = useRef();\r\n\r\n\tconst openPhotoBox = () => setIsPhotoChangerBoxOpen(true);\r\n\tconst closePhotoBox = () => setIsPhotoChangerBoxOpen(false);\r\n\tconst removePhoto = async () =>\r\n\t{\r\n\t\tclosePhotoBox();\r\n\t\tsetIsPhotoLoading(true);\r\n\t\ttry {\r\n\t\t\tconst result = await fetch(`${backend}/user/edit/profile-pic/reset`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\r\n\t\t\tif (!result.ok)\r\n\t\t\t{\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\t\t\t}\r\n\t\t\tawait updateUserLocally();\r\n\t\t} catch(err) {\r\n\t\t\tdispatch(setSnackbar(err.message, \"error\"));\r\n\t\t}\r\n\t\tsetIsPhotoLoading(false);\r\n\t};\r\n\tconst openPhotoUpload = () => uploadRef.current.click();\r\n\tconst uploadPhoto = async input =>\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tconst uploadedPhoto = input.target.files[0];\r\n\t\t\tif (!uploadedPhoto)\r\n\t\t\t\tthrow new Error(\"No photo uploaded\");\r\n\t\t\tconst acceptedFormats = uploadRef.current.accept.split(\", \");\r\n\t\t\tif (!acceptedFormats.includes(uploadedPhoto.type))\r\n\t\t\t  throw new Error(\"Not a supported photo format\");\r\n\t\t\tclosePhotoBox();\r\n\t\t\tsetIsPhotoLoading(true);\r\n\r\n\t\t\tconst form = new FormData();\r\n\t\t\tform.append(\"newProfilePic\", uploadedPhoto);\r\n\t\t\tconst result = await fetch(`${backend}/user/edit/profile-pic`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t},\r\n\t\t\t\tbody: form\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\tif (!result.ok)\r\n\t\t\t{\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\t\t\t}\r\n\t\r\n\t\t\tawait updateUserLocally();\r\n\t\t\tuploadRef.current.value = \"\";\r\n\t\t\tsetIsPhotoLoading(false);\r\n\t\t\tdispatch(setSnackbar(\"Photo updated successfully\", \"success\"));\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tconsole.error(err);\r\n\t\t\tif (err.message === \"No photo uploaded\")\r\n\t\t\t\treturn null;\r\n\t\t\tif (err.message === \"Not a supported photo format\")\r\n\t\t\t\treturn dispatch(setSnackbar(\"Not a supported photo format.\", \"error\"));\r\n\t\t\tdispatch(setSnackbar(\"Oops, please try again later.\", \"error\"));\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleChange = () => isInfoValid ? null : setIsInfoValid(true);\r\n\r\n\tconst handleEmailChange = async e =>\r\n\t{\r\n\t\te.preventDefault();\r\n\t\tif (!isEmailValid) return;\r\n\t\tsetIsLoadingEmail(true);\r\n\t\tconst email = emailRef.current.value;\r\n\t\tconst password = confirmPasswordRef.current.value;\r\n\t\ttry {\r\n\t\t\tif (email.trim() === \"\") throw new Error(\"Email can't be empty\");\r\n\t\t\t// eslint-disable-next-line no-control-regex\r\n\t\t\tif (!email.match(/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])/))\r\n\t\t\t\tthrow new Error(\"Email is invalid\");\r\n\t\t\tif (password.trim() === \"\") throw new Error(\"Password can't be empty\");\r\n\t\t\t\r\n\t\t\tconst result = await fetch(`${backend}/auth/send-email-change-verification`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`,\r\n\t\t\t\t\t\"Content-Type\": \"application/json\"\r\n\t\t\t\t},\r\n\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\temail,\r\n\t\t\t\t\tpassword\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\tif (!result.ok) {\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail);\r\n\t\t\t}\r\n\t\t\tdispatch(setSnackbar(\"Email verification sent.\", \"success\"));\r\n\t\t} catch(err) {\r\n\t\t\tdispatch(setSnackbar(err.message, \"error\"));\r\n\t\t}\r\n\t\tsetIsLoadingEmail(false);\r\n\t};\r\n\r\n\tconst handleSubmit = async e =>\r\n\t{\r\n\t\te.preventDefault();\r\n\t\tif (!isInfoValid) return;\r\n\t\tsetIsLoadingInfo(true);\r\n\t\ttry\r\n\t\t{\r\n\t\t\tlet realName = nameRef.current.value;\r\n\t\t\tlet username = currentUser.username === \"guest\" ? \"guest\" : usernameRef.current.value;\r\n\t\t\tlet bio = bioRef.current.value;\r\n\t\t\t\r\n\t\t\tif (currentUser.username !== \"guest\" && currentUser.username !== usernameRef.current.value) {\r\n\t\t\t\tif (username.length > 20) throw new Error(\"Username too long\");\r\n\t\t\t\tif (username.trim() === \"\") throw new Error(\"Username not entered\");\r\n\t\t\t\tif (!username.match(/^[A-Za-z0-9]*$/)) throw new Error(\"Username not English\");\r\n\t\t\t}\r\n\t\t\tif (currentUser.bio !== bioRef.current.value)\r\n\t\t\t\tif (bio.length > 150) throw new Error(\"Bio too long\");\r\n\r\n\t\t\tconst result = await fetch(`${backend}/user/edit`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`,\r\n\t\t\t\t\t\"Content-Type\": \"application/json\"\r\n\t\t\t\t},\r\n\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\tusername: username,\r\n\t\t\t\t\trealname: realName.trim().length === 0 ? null : realName,\r\n\t\t\t\t\tbio: bio.trim().length === 0 ? null : bio\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\tif (!result.ok)\r\n\t\t\t{\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\t\t\t}\r\n\t\t\tawait updateUserLocally();\r\n\t\t\tdispatch(setSnackbar(\"Info updated.\", \"success\"));\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tsetIsInfoValid(false);\r\n\t\t\tdispatch(setSnackbar(err.message ?? \"Oops, please try again later.\", \"error\"));\r\n\t\t}\r\n\t\tsetIsLoadingInfo(false);\r\n\t};\r\n\r\n\tconst updateUserLocally = async () => await refreshOrLogout(dispatch, history);\r\n\r\n\tif (!currentUser) return <LoadingPage/>;\r\n\treturn(\r\n\t\t<div className=\"account-element edit-profile\">\r\n\t\t\t{ isPhotoChangerBoxOpen &&\r\n\t\t\t\t\t<div className=\"dialog-box-container\" onClick={closePhotoBox}>\r\n\t\t\t\t\t\t<div className=\"dialog-box\" onClick={e => e.stopPropagation()}>\r\n\t\t\t\t\t\t\t<h2>Change Profile Photo</h2>\r\n\t\t\t\t\t\t\t<button className=\"upload text\" onClick={openPhotoUpload}>Upload Photo</button>\r\n\t\t\t\t\t\t\t<button className=\"remove text\" onClick={removePhoto}>Remove Current Photo</button>\r\n\t\t\t\t\t\t\t<button className=\"cancel text\" onClick={closePhotoBox}>Cancel</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t\t<div className=\"element profile-pic-container\">\r\n\t\t\t\t<div className=\"img-container outlined left\" onClick={openPhotoBox}>\r\n\t\t\t\t\t{ isPhotoLoading && <div className=\"loading\"><img src={Loading} alt=\"loading\"></img></div>}\r\n\t\t\t\t\t<img src={currentUser.profilePic} alt={`${currentUser.username}'s profile pic'`}></img>\r\n\t\t\t\t\t<input id=\"photo\" type=\"file\" accept=\"image/png, image/jpg, image/jpeg, image/pjpeg, image/jfif, image/pjp\" style={{display: \"none\"}} ref={uploadRef} onChange={uploadPhoto}></input>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"right\">\r\n\t\t\t\t\t{currentUser.username}\r\n\t\t\t\t\t<button className=\"text\" onClick={openPhotoBox}>Change Profile Photo</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<form onSubmit={handleSubmit}>\r\n\t\t\t\t<div className=\"element\">\r\n\t\t\t\t\t<label htmlFor=\"name\" className=\"left\">Name</label>\r\n\t\t\t\t\t<div className=\"right\">\r\n\t\t\t\t\t\t<input type=\"text\" id=\"name\" defaultValue={currentUser.realName} placeholder=\"Name\" ref={nameRef} className=\"outlined\" onChange={handleChange}></input>\r\n\t\t\t\t\t\t<p>Help people discover your account by using the name you're known by: either your full name, nickname, or business name.</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t{ currentUser.username !== \"guest\" &&\r\n\t\t\t\t\t<div className=\"element\">\r\n\t\t\t\t\t\t<label htmlFor=\"username\" className=\"left\">Username</label>\r\n\t\t\t\t\t\t<div className=\"right\">\r\n\t\t\t\t\t\t\t<input type=\"text\" id=\"username\" defaultValue={currentUser.username} placeholder=\"Username\" ref={usernameRef} className=\"outlined\" onChange={handleChange}></input>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t<div className=\"element\">\r\n\t\t\t\t\t<label htmlFor=\"bio\" className=\"left\">Bio</label>\r\n\t\t\t\t\t<div className=\"right\">\r\n\t\t\t\t\t\t<textarea id=\"bio\" defaultValue={currentUser.bio} ref={bioRef} className=\"outlined\" onChange={handleChange}></textarea>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"element\">\r\n\t\t\t\t\t<div className=\"left\"></div>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tisLoadingInfo\r\n\t\t\t\t\t\t\t? <button className=\"loading\"><div><img src={Loading} alt=\"loading\"></img></div></button>\r\n\t\t\t\t\t\t\t: <button className={`submit ${isInfoValid ? null : \"disabled\"}`}>Submit</button>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t</form>\r\n\t\t\t{ currentUser.username !== \"guest\" &&\r\n\t\t\t\t<form onSubmit={handleEmailChange}>\r\n\t\t\t\t\t<div className=\"element info\">\r\n\t\t\t\t\t\t<span className=\"left\"></span>\r\n\t\t\t\t\t\t<div className=\"right\">\r\n\t\t\t\t\t\t\t<p className=\"header\">Personal Information</p>\r\n\t\t\t\t\t\t\t<p>Provide your personal information, even if the account is used for a business, a pet or something else. This won't be a part of your public profile.</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"element\">\r\n\t\t\t\t\t\t<label htmlFor=\"email\" className=\"left\">Email</label>\r\n\t\t\t\t\t\t<div className=\"right\">\r\n\t\t\t\t\t\t\t<input type=\"text\" id=\"email\" defaultValue={currentUser.email} placeholder=\"Email\" ref={emailRef} className=\"outlined\" onChange={() => isEmailValid ? null : setIsEmailValid(true)}></input>\r\n\t\t\t\t\t\t\t{ !emailRef.current || currentUser.email === emailRef.current.value\r\n\t\t\t\t\t\t\t\t? null \r\n\t\t\t\t\t\t\t\t: <input type=\"password\" id=\"password\" placeholder=\"Confirm Password\" ref={confirmPasswordRef} className=\"outlined\"></input>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"element\">\r\n\t\t\t\t\t\t<div className=\"left\"></div>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tisLoadingEmail\r\n\t\t\t\t\t\t\t\t? <button className=\"loading\"><div><img src={Loading} alt=\"loading\"></img></div></button>\r\n\t\t\t\t\t\t\t\t: <button className={`submit ${isEmailValid ? null : \"disabled\"}`}>Submit</button>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</form>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default EditProfile;\r\n","import { useEffect } from \"react\";\r\nimport { Route, Switch, useHistory } from \"react-router\";\r\nimport { NavLink } from \"react-router-dom\";\r\nimport { useMediaQuery } from \"react-responsive\";\r\nimport ChangePassword from \"./ChangePassword\";\r\nimport EditProfile from \"./EditProfile\";\r\nimport \"./acc-edit.css\";\r\nimport { useSelector } from \"react-redux\";\r\n\r\nconst AccountEdit = () =>\r\n{\r\n\tconst history = useHistory();\r\n\tconst phoneQuery = useMediaQuery({query: \"(max-width: 600px)\"});\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tif (history.location.pathname === \"/accounts/edit\")\r\n\t\t\tdocument.title = \"Edit Profile • Instadicey\";\r\n\t\telse if (history.location.pathname === \"/accounts/password/change\")\r\n\t\t\tdocument.title = \"Change Password • Instadicey\";\r\n\t}, [history.location.pathname]);\r\n\r\n\treturn(\r\n\t\t<div className=\"account-edit outlined\">\r\n\t\t\t{ !phoneQuery &&\r\n\t\t\t\t<ul className=\"sidebar\">\r\n\t\t\t\t\t<li><NavLink exact to=\"/accounts/edit\" activeClassName=\"selected\">Edit Profile</NavLink></li>\r\n\t\t\t\t\t{currentUser.username !== \"guest\" && <li><NavLink to=\"/accounts/password/change\" activeClassName=\"selected\">Change Password</NavLink></li>}\r\n\t\t\t\t</ul>\r\n\t\t\t}\r\n\t\t\t<div className=\"main\">\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path=\"/accounts/edit\" component={EditProfile}></Route>\r\n\t\t\t\t\t{currentUser.username !== \"guest\" && <Route exact path=\"/accounts/password/change\" component={ChangePassword}></Route>}\r\n\t\t\t\t</Switch>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default AccountEdit;\r\n","import { useEffect, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { setSnackbar } from \"../state/actions/snackbar\";\r\nimport Loading from \"../assets/misc/loading.jpg\";\r\nimport { backend } from \"../config\";\r\nimport { logOut } from \"../helpers\";\r\nimport { useHistory } from \"react-router-dom/cjs/react-router-dom.min\";\r\n\r\nconst FollowButton = ({ target }) =>\r\n{\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\tconst [isLoading, setIsLoading] = useState(null);\r\n\tconst [isFollowing, setIsFollowing] = useState(false);\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tif (currentUser) {\r\n\t\t\tconst checkIfFollowing = async () =>\r\n\t\t\t{\r\n\t\t\t\tsetIsLoading(true);\r\n\t\t\t\tconst result = await fetch(`${backend}/user/following-check/${target.username}`, {\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (result.status === 401)\r\n\t\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\t\tif (!result.ok)\r\n\t\t\t\t\treturn setIsFollowing(false);\r\n\r\n\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tsetIsFollowing(resultJSON);\r\n\t\t\t\tsetIsLoading(false);\r\n\t\t\t};\r\n\t\t\tcheckIfFollowing();\r\n\t\t}\r\n\t}, [currentUser, target]);\r\n\r\n\tconst follow = async () => {\r\n\t\tsetIsLoading(true);\r\n\t\ttry {\r\n\t\t\tconst result = await fetch(`${backend}/user/follow/${target.username}`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\t\r\n\t\t\tif (!result.ok)\r\n\t\t\t{\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\t\t\t}\r\n\t\t\tsetIsFollowing(true);\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tconst errors = err.cause ?? [];\r\n\t\t\tif (errors.some(e => e.code === \"NotFound\"))\r\n\t\t\t\tdispatch(setSnackbar(\"User not found.\", \"error\"));\r\n\t\t\telse if (errors.some(e => e.code === \"Duplicate\"))\r\n\t\t\t\tdispatch(setSnackbar(\"User already followed\", \"error\"));\r\n\t\t\telse\r\n\t\t\t\tdispatch(setSnackbar(err.message, \"error\"));\r\n\t\t}\r\n\t\tsetIsLoading(false);\r\n\t};\r\n\tconst unfollow = async () => {\r\n\t\tsetIsLoading(true);\r\n\t\ttry {\r\n\t\t\tconst result = await fetch(`${backend}/user/unfollow/${target.username}`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\t\r\n\t\t\tif (!result.ok)\r\n\t\t\t{\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\t\t\t}\r\n\t\t\tsetIsFollowing(false);\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tconst errors = err.cause ?? [];\r\n\t\t\tif (errors.some(e => e.code === \"NotFound\"))\r\n\t\t\t\tdispatch(setSnackbar(\"User not found.\", \"error\"));\r\n\t\t\telse if (errors.some(e => e.code === \"Duplicate\"))\r\n\t\t\t\tdispatch(setSnackbar(\"User already not followed\", \"error\"));\r\n\t\t\telse\r\n\t\t\t\tdispatch(setSnackbar(err.message, \"error\"));\r\n\t\t}\r\n\t\tsetIsLoading(false);\r\n\t};\r\n\r\n\tif (isLoading) return <button className=\"follow-btn loading\"><div><img src={Loading} alt=\"loading\"></img></div></button>;\r\n\tif (isFollowing)\r\n\t\treturn <button className=\"follow-btn unfollow\" onClick={unfollow}>Unfollow</button>;\r\n\telse\r\n\t\treturn <button className=\"follow-btn follow\" onClick={follow}>Follow</button>;\r\n};\r\n\r\nexport default FollowButton;\r\n","const VerifiedTick = ({size = 24, user, marginLeft = 10, marginRight = 0}) =>\r\n{\r\n\tif (user.isVerified) return(\r\n\t\t<span className=\"verified\" style={{marginLeft, marginRight}}>\r\n\t\t\t<svg xmlns='http://www.w3.org/2000/svg' width={size} height={size} viewBox='0 0 24 24'><path d='M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-1.959 17l-4.5-4.319 1.395-1.435 3.08 2.937 7.021-7.183 1.422 1.409-8.418 8.591z'/></svg>\r\n\t\t</span>\r\n\t);\r\n\telse return null;\r\n};\r\n\r\nexport default VerifiedTick;\r\n","import { useState } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport FollowButton from \"./FollowButton\";\r\nimport VerifiedTick from \"./VerifiedTick\";\r\nimport { useHistory } from \"react-router-dom/cjs/react-router-dom.min\";\r\nimport { startLoading, stopLoading } from \"../state/actions/isLoading\";\r\nimport { backend } from \"../config\";\r\nimport { logOut } from \"../helpers\";\r\nimport { setSnackbar } from \"../state/actions/snackbar\";\r\n\r\nconst FollowWindow = props =>\r\n{\r\n\tconst { title, users, closeFollowListWindow, newMessage } = props;\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\r\n\tconst handleStartChat = async (targetUsername) =>\r\n\t{\r\n\t\tcloseFollowListWindow();\r\n\t\tdispatch(startLoading());\r\n\t\ttry {\r\n\t\t\tconst result = await fetch(`${backend}/chat/room`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`,\r\n\t\t\t\t\t\"Content-Type\": \"application/json\"\r\n\t\t\t\t},\r\n\t\t\t\tbody: JSON.stringify([targetUsername])\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\tconst resultJSON = await result.json();\r\n\t\t\tif (!result.ok)\r\n\t\t\t\tthrow new Error(resultJSON.detail);\r\n\t\t\thistory.push(`/direct/t/${resultJSON.id}`);\r\n\t\t} catch (err) {\r\n\t\t\tdispatch(setSnackbar(err.message, \"error\"));\r\n\t\t}\r\n\t\tdispatch(stopLoading());\r\n\t};\r\n\r\n\treturn(\r\n\t\t<div className=\"backdrop container\" onClick={closeFollowListWindow}>\r\n\t\t\t<div className=\"follow-list-window\" onClick={e => e.stopPropagation()}>\r\n\t\t\t\t<div className=\"header\">\r\n\t\t\t\t\t<h1>{title}</h1>\r\n\t\t\t\t\t<span className=\"close\" onClick={closeFollowListWindow}>X</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t{ isLoading\r\n\t\t\t\t\t? \r\n\t\t\t\t\t<ul className=\"loading\">\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t[0,1,2,3,4,5,6,7,8].map(n =>\r\n\t\t\t\t\t\t\t\t<li className=\"person\" key={n}>\r\n\t\t\t\t\t\t\t\t\t<div className=\"profile\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"profile-pic\"></div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"info\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"real-name\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"username\"></span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t\t:\r\n\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tnewMessage\r\n\t\t\t\t\t\t\t\t?\r\n\t\t\t\t\t\t\t\tusers.map(person => \r\n\t\t\t\t\t\t\t\t\t<Link to=\"\" className=\"person\" key={person.username} onClick={() => handleStartChat(person.username)}>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"profile\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"profile-pic\"><img src={person.profilePic} alt={`${person.username}'s Pic`}></img></div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"info\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div style={{display: \"flex\"}}><span className=\"username\">{person.username}</span></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"real-name\">{person.realName}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\tusers.map(person => \r\n\t\t\t\t\t\t\t\t\t<li className=\"person\" key={person.username}>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"profile\">\r\n\t\t\t\t\t\t\t\t\t\t\t<Link to={`/${person.username}`}><div className=\"profile-pic\"><img src={person.profilePic} alt={`${person.username}'s Pic`}></img></div></Link>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"info\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div style={{display: \"flex\"}}><Link to={`/${person.username}`} className=\"username\">{person.username}</Link> <VerifiedTick user={person} size={15} marginLeft={7.5}/></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"real-name\">{person.realName}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t{currentUser && currentUser.username === person.username ? null : <FollowButton target={person} startLoading={() => setIsLoading(true)} stopLoading={() => setIsLoading(false)}/>}\r\n\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default FollowWindow;\r\n","import { useEffect, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { setSnackbar } from \"../../state/actions/snackbar\";\r\nimport { backend } from \"../../config\";\r\nimport { logOut } from \"../../helpers\";\r\nimport { useHistory } from \"react-router-dom/cjs/react-router-dom.min\";\r\n\r\nconst Like = ({size = 25, target, isComment}) =>\r\n{\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\tconst [isLiked, setIsLiked] = useState(false);\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tconst checkIfLiked = async () =>\r\n\t\t{\r\n\t\t\tif (currentUser && target.likes.some(u => u.username === currentUser.username))\r\n\t\t\t\tsetIsLiked(true);\r\n\t\t};\r\n\t\tcheckIfLiked();\r\n\t}, [currentUser, target]);\r\n\r\n\tconst like = async () =>\r\n\t{\r\n\t\tif (!currentUser) return alert(\"sign in\");\r\n\t\ttry\r\n\t\t{\r\n\t\t\tvar result;\r\n\t\t\tif (isComment)\r\n\t\t\t\tresult = await fetch(`${backend}/like/comment/${target.id}`, {\r\n\t\t\t\t\tmethod: \"POST\",\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\telse\r\n\t\t\t\tresult = await fetch(`${backend}/like/post/${target.id}`, {\r\n\t\t\t\t\tmethod: \"POST\",\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\tif (!result.ok) {\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\t\t\t}\r\n\t\t\tsetIsLiked(true);\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tdispatch(setSnackbar(err.message ?? \"Oops, try again later.\", \"error\"));\r\n\t\t}\r\n\t};\r\n\t\r\n\tconst unlike = async () =>\r\n\t{\r\n\t\tif (!currentUser) return alert(\"sign in\");\r\n\t\ttry\r\n\t\t{\r\n\t\t\tvar result;\r\n\t\t\tif (isComment)\r\n\t\t\t\tresult = await fetch(`${backend}/like/comment/remove/${target.id}`, {\r\n\t\t\t\t\tmethod: \"POST\",\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\telse\r\n\t\t\t\tresult = await fetch(`${backend}/like/post/remove/${target.id}`, {\r\n\t\t\t\t\tmethod: \"POST\",\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\tif (!result.ok) {\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\t\t\t}\r\n\t\t\tsetIsLiked(false);\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tdispatch(setSnackbar(err.message ?? \"Oops, try again later.\", \"error\"));\r\n\t\t}\r\n\t};\r\n\r\n\tif (isLiked)\r\n\t\treturn(\r\n\t\t\t<button className=\"like liked icon\" onClick={unlike}>\r\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width={size} height={size} viewBox=\"0 0 24 24\"><path d=\"M12 4.248c-3.148-5.402-12-3.825-12 2.944 0 4.661 5.571 9.427 12 15.808 6.43-6.381 12-11.147 12-15.808 0-6.792-8.875-8.306-12-2.944z\"/></svg>\r\n\t\t\t</button>\r\n\t\t);\r\n\telse return(\r\n\t\t<button className=\"like icon\" onClick={like}>\r\n\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width={size} height={size} viewBox=\"0 0 24 24\" fillRule=\"evenodd\" clipRule=\"evenodd\"><path d=\"M12 21.593c-5.63-5.539-11-10.297-11-14.402 0-3.791 3.068-5.191 5.281-5.191 1.312 0 4.151.501 5.719 4.457 1.59-3.968 4.464-4.447 5.726-4.447 2.54 0 5.274 1.621 5.274 5.181 0 4.069-5.136 8.625-11 14.402m5.726-20.583c-2.203 0-4.446 1.042-5.726 3.238-1.285-2.206-3.522-3.248-5.719-3.248-3.183 0-6.281 2.187-6.281 6.191 0 4.661 5.571 9.429 12 15.809 6.43-6.38 12-11.148 12-15.809 0-4.011-3.095-6.181-6.274-6.181\"/></svg>\r\n\t\t</button>\r\n\t);\r\n};\r\n\r\nexport default Like;\r\n","import { useState } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { format, formatDistanceToNowStrict } from \"date-fns\";\r\nimport VerifiedTick from \"../VerifiedTick\";\r\nimport Like from \"./Like\";\r\nimport { backend } from \"../../config\";\r\nimport { logOut } from \"../../helpers\";\r\nimport { useHistory } from \"react-router-dom/cjs/react-router-dom.min\";\r\nimport { setSnackbar } from \"../../state/actions/snackbar\";\r\n\r\nconst Comment = ({ commentData, postData, noPhoto, noTimestamp, noLike, noLikesCounter, noRemove, setLikesWindow, refreshComments}) =>\r\n{\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\tconst createdAtDate = new Date(commentData.createdAt);\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\r\n\tconst removeComment = async () =>\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tsetIsLoading(true);\r\n\t\t\tconst result = await fetch(`${backend}/comment/delete/${commentData.id}`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\r\n\t\t\tif (!result.ok)\r\n\t\t\t{\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\t\t\t}\r\n\t\t\tawait refreshComments();\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tdispatch(setSnackbar(err.message, \"error\"));\r\n\t\t}\r\n\t\tsetIsLoading(false);\r\n\t};\r\n\r\n\treturn(\r\n\t\t<div className={`comment ${isLoading ? \"disabled\" : null}`} style={noLike ? null : {paddingRight: \"25px\"}}>\r\n\t\t\t{noPhoto || <Link to={`/${commentData.user.username}`}><div className=\"profile-pic\"><img src={commentData.user.profilePic} alt={`${commentData.user.username}'s profile pic`}></img></div></Link>}\r\n\t\t\t<div className=\"info\">\r\n\t\t\t\t<div style={{display: \"inline-block\"}}>\r\n\t\t\t\t\t<Link to={`/${commentData.user.username}`} className=\"username\">{commentData.user.username}</Link>\r\n\t\t\t\t\t<VerifiedTick size={12.5} user={commentData.user} marginLeft={0} marginRight={7.5}/>\r\n\t\t\t\t\t<span className=\"text\">{commentData.comment}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{noTimestamp || <span className=\"timestamp\" title={format(createdAtDate, \"d MMM, yyyy\")}>{formatDistanceToNowStrict(createdAtDate)}</span>}\r\n\t\t\t\t\t{ noLikesCounter || commentData.likes.length === 0 ||\r\n\t\t\t\t\t\t<span className=\"likes\" onClick={() => setLikesWindow(commentData.likes)}>{commentData.likes.length} likes</span>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{currentUser && (currentUser.username === commentData.user.username || currentUser.username === postData.user.username) && !noRemove && <button className=\"icon\" style={{width: 15, height: 15}} onClick={removeComment}><svg width=\"15\" height=\"15\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fillRule=\"evenodd\" clipRule=\"evenodd\"><path d=\"M9 3h6v-1.75c0-.066-.026-.13-.073-.177-.047-.047-.111-.073-.177-.073h-5.5c-.066 0-.13.026-.177.073-.047.047-.073.111-.073.177v1.75zm11 1h-16v18c0 .552.448 1 1 1h14c.552 0 1-.448 1-1v-18zm-10 3.5c0-.276-.224-.5-.5-.5s-.5.224-.5.5v12c0 .276.224.5.5.5s.5-.224.5-.5v-12zm5 0c0-.276-.224-.5-.5-.5s-.5.224-.5.5v12c0 .276.224.5.5.5s.5-.224.5-.5v-12zm8-4.5v1h-2v18c0 1.105-.895 2-2 2h-14c-1.105 0-2-.895-2-2v-18h-2v-1h7v-2c0-.552.448-1 1-1h6c.552 0 1 .448 1 1v2h7z\"/></svg></button>}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t{noLike || <Like size={15} target={commentData} isComment/>}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default Comment;\r\n","import { useEffect, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { setSnackbar } from \"../../state/actions/snackbar\";\r\nimport { backend } from \"../../config\";\r\nimport { logOut } from \"../../helpers\";\r\nimport { useHistory } from \"react-router-dom/cjs/react-router-dom.min\";\r\n\r\nconst Save = ({size = 25, target}) =>\r\n{\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\tconst [isSaved, setIsSaved] = useState(false);\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tconst checkIfSaved = async () =>\r\n\t\t{\r\n\t\t\tif (!currentUser) return;\r\n\r\n\t\t\tconst savedPosts = await fetch(`${backend}/user/saved-posts`, {\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconst savedPostsJSON = await savedPosts.json();\r\n\r\n\t\t\tif (savedPosts.ok && savedPostsJSON.some(p => p.id === target.id))\r\n\t\t\t\tsetIsSaved(true);\r\n\t\t};\r\n\t\tcheckIfSaved();\r\n\t}, [currentUser, target]);\r\n\r\n\tconst save = async () =>\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tconst result = await fetch(`${backend}/user/saved-posts/${target.id}`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\r\n\t\t\tif (!result.ok)\r\n\t\t\t{\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\t\t\t}\r\n\t\t\tsetIsSaved(true);\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tdispatch(setSnackbar(err.message ?? \"Oops, try again later.\", \"error\"));\r\n\t\t}\r\n\t};\r\n\r\n\tconst unsave = async () =>\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tconst result = await fetch(`${backend}/user/saved-posts/remove/${target.id}`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\r\n\t\t\tif (!result.ok)\r\n\t\t\t{\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\t\t\t}\r\n\t\t\tsetIsSaved(false);\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tdispatch(setSnackbar(err.message ?? \"Oops, try again later.\", \"error\"));\r\n\t\t}\r\n\t};\r\n\r\n\t if (isSaved) return(\r\n\t\t<button className=\"save saved icon\" onClick={unsave}>\r\n\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width={size} height={size} viewBox=\"0 0 24 24\"><path d=\"M18 24l-6-5.269-6 5.269v-24h12v24z\"/></svg>\r\n\t\t</button>\r\n\t);\r\n\telse return(\r\n\t\t<button className=\"save icon\" onClick={save}>\r\n\t\t\t<svg width={size} height={size} viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fillRule=\"evenodd\" clipRule=\"evenodd\"><path d=\"M5 0v24l7-6 7 6v-24h-14zm1 1h12v20.827l-6-5.144-6 5.144v-20.827z\"></path></svg>\r\n\t\t</button>\r\n\t);\r\n};\r\n\r\nexport default Save;\r\n","import { useRef, useState, useEffect } from \"react\";\r\nimport { Link, useHistory, useLocation } from \"react-router-dom\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { format, formatDistanceToNowStrict, getYear } from \"date-fns\";\r\nimport { setSnackbar } from \"../../state/actions/snackbar\";\r\nimport FollowButton from \"../FollowButton\";\r\nimport FollowWindow from \"../FollowWindow\";\r\nimport Like from \"./Like\";\r\nimport Comment from \"./Comment\";\r\nimport Save from \"./Save\";\r\nimport VerifiedTick from \"../VerifiedTick\";\r\nimport { backend } from \"../../config\";\r\nimport { logOut } from \"../../helpers\";\r\n\r\nconst PostWindow = ({post, isVertical, refreshPost}) =>\r\n{\r\n\tconst history = useHistory();\r\n\tconst location = useLocation();\r\n\tconst addComment = useRef();\r\n\tconst dispatch = useDispatch();\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\r\n\tconst createdAtDate = new Date(post.createdAt);\r\n\tconst [fullCommentsFlag, setFullCommentsFlag] = useState(false);\r\n\r\n\tconst [isInfoValid, setIsInfoValid] = useState(false);\r\n\tconst [commentLoading, setCommentLoading] = useState(false);\r\n\tconst [isDialogBoxOpen, setIsDialogBoxOpen] = useState(false);\r\n\tconst closeDialogBox = () => setIsDialogBoxOpen(false);\r\n\tconst [likesWindow, setLikesWindow] = useState(null);\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\r\n\tuseEffect(() =>\r\n\t{\r\n\t\treturn () => closeDialogBox();\r\n\t}, []);\r\n\r\n\tconst handleAddComment = async e =>\r\n\t{\r\n\t\te.preventDefault();\r\n\t\tif (!isInfoValid) return;\r\n\r\n\t\ttry\r\n\t\t{\r\n\t\t\tsetCommentLoading(true);\r\n\t\t\tconst comment = addComment.current.value;\r\n\t\t\tif (comment.trim().length < 1)\r\n\t\t\t\treturn dispatch(setSnackbar(\"Please enter a comment.\", \"error\"));\r\n\t\t\tif (comment.length > 2200)\r\n\t\t\t\treturn dispatch(setSnackbar(\"Comment too long. max is 2200 characters.\", \"error\"));\r\n\r\n\t\t\tconst result = await fetch(`${backend}/comment/post/${post.id}`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t\"Content-Type\": \"application/json\",\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t},\r\n\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\tcomment: comment\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\r\n\t\t\tif (!result.ok)\r\n\t\t\t{\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\t\t\t}\r\n\t\t\tawait refreshPost();\r\n\t\t\tsetCommentLoading(false);\r\n\t\t\taddComment.current.value = \"\";\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tdispatch(setSnackbar(err.message ?? \"Oops, try again later.\", \"error\"));\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleTextareaEnter = e =>\r\n\t{\r\n\t\tif(e.keyCode === 13 && e.shiftKey === false)\r\n\t\t{\r\n\t\t\te.preventDefault();\r\n\t\t\thandleAddComment(e);\r\n\t\t}\r\n\t};\r\n\r\n\tconst deletePost = async () =>\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tif (currentUser.username !== post.user.username) throw new Error(\"Fuck off\");\r\n\t\t\tsetIsLoading(true);\r\n\t\t\t\r\n\t\t\tconst result = await fetch(`${backend}/post/delete/${post.id}`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\r\n\t\t\tif (!result.ok) {\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\t\t\t}\r\n\t\t\thistory.push(\"/\");\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tdispatch(setSnackbar(err.message, \"error\"));\r\n\t\t}\r\n\t\tsetIsLoading(false);\r\n\t};\r\n\r\n\tif (!currentUser || !post) return null;\r\n\tif (isVertical)\r\n\t\treturn(\r\n\t\t\t<div className=\"post-window outlined vertical\">\r\n\t\t\t\t{ likesWindow\r\n\t\t\t\t\t? <FollowWindow title=\"Likes\" users={likesWindow} closeFollowListWindow={() => setLikesWindow(null)}/>\r\n\t\t\t\t\t: null\r\n\t\t\t\t}\r\n\t\t\t\t{ isDialogBoxOpen &&\r\n\t\t\t\t<div className=\"dialog-box-container\" onClick={closeDialogBox}>\r\n\t\t\t\t\t<div className=\"dialog-box\" onClick={e => e.stopPropagation()}>\r\n\t\t\t\t\t\t{location.pathname !== \"/\" ? null : <button className=\"text\" onClick={() => history.push(`/p/${post.id}`)}>Go to post</button>}\r\n\t\t\t\t\t\t{location.pathname !== \"/\" ? null : <button className=\"text\" onClick={() => { navigator.clipboard.writeText(`${window.location.origin}/#/p/${post.id}`); closeDialogBox(); }}>Copy Link</button>}\r\n\t\t\t\t\t\t{currentUser.username === post.user.username && <button className=\"remove text\" onClick={deletePost}>Delete</button>}\r\n\t\t\t\t\t\t<button className=\"cancel text\" onClick={closeDialogBox}>Cancel</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t<div className=\"poster\">\r\n\t\t\t\t\t<Link to={`/${post.user.username}`}><div className=\"profile-pic outlined round\"><img src={post.user.profilePic} alt=\"Profile Pic\"></img></div></Link>\r\n\t\t\t\t\t<Link to={`/${post.user.username}`} className=\"username\">{post.user.username}</Link>\r\n\t\t\t\t\t<button className=\"icon\" style={{width: 15, height: 15}} onClick={() => setIsDialogBoxOpen(true)}><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6 12c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3zm9 0c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3zm9 0c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3z\"/></svg></button>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"post-photo\">\r\n\t\t\t\t\t<div className=\"container\">\r\n\t\t\t\t\t\t<img src={post.photo} alt={post.caption}></img>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"side\">\r\n\t\t\t\t\t<div className=\"info\">\r\n\t\t\t\t\t\t<div className=\"interactions\">\r\n\t\t\t\t\t\t\t<div style={{display: \"flex\"}}>\r\n\t\t\t\t\t\t\t\t<Like target={post}/>\r\n\t\t\t\t\t\t\t\t<button className=\"comment-bubble icon\"><svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fillRule=\"evenodd\" clipRule=\"evenodd\"><path d=\"M12 1c-6.338 0-12 4.226-12 10.007 0 2.05.739 4.063 2.047 5.625l-1.993 6.368 6.946-3c1.705.439 3.334.641 4.864.641 7.174 0 12.136-4.439 12.136-9.634 0-5.812-5.701-10.007-12-10.007m0 1c6.065 0 11 4.041 11 9.007 0 4.922-4.787 8.634-11.136 8.634-1.881 0-3.401-.299-4.946-.695l-5.258 2.271 1.505-4.808c-1.308-1.564-2.165-3.128-2.165-5.402 0-4.966 4.935-9.007 11-9.007\"/></svg></button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<Save target={post}/>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<span className=\"likes\" onClick={() => setLikesWindow(post.likes)}><span className=\"number\">{post.likes.length}</span> likes</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"comments\">\r\n\t\t\t\t\t\t{ post.caption?.length === 0 ||\r\n\t\t\t\t\t\t\t<Comment\r\n\t\t\t\t\t\t\t\tcommentData={{user: post.user, comment: post.caption, timestamp: post.timestamp}}\r\n\t\t\t\t\t\t\t\tnoLike\r\n\t\t\t\t\t\t\t\tnoPhoto\r\n\t\t\t\t\t\t\t\tnoTimestamp\r\n\t\t\t\t\t\t\t\tnoLikesCounter\r\n\t\t\t\t\t\t\t\tnoRemove\r\n\t\t\t\t\t\t\t\tpostData={post}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{post.comments.length > 2 && !fullCommentsFlag &&\r\n\t\t\t\t\t\t\t<Link onClick={() => setFullCommentsFlag(true)} to={`/p/${post.id}`} style={{color: \"#8e8e8e\", fontSize: \"0.9em\", fontWeight: \"500\"}}>View all {post.comments.length} comments</Link>}\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tpost.comments.slice(0, fullCommentsFlag ? post.comments.length : 2).map(comment =>\r\n\t\t\t\t\t\t\t\t<Comment\r\n\t\t\t\t\t\t\t\t\tpostData = {post}\r\n\t\t\t\t\t\t\t\t\tcommentData={comment}\r\n\t\t\t\t\t\t\t\t\tkey={comment.id}\r\n\t\t\t\t\t\t\t\t\tsetLikesWindow={setLikesWindow}\r\n\t\t\t\t\t\t\t\t\trefreshComments={refreshPost}\r\n\t\t\t\t\t\t\t\t\tnoPhoto\r\n\t\t\t\t\t\t\t\t\tnoTimestamp\r\n\t\t\t\t\t\t\t\t\tnoLikesCounter\r\n\t\t\t\t\t\t\t\t/>)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<span className=\"timestamp\" title={format(createdAtDate, \"d MMM, yyyy\")}>\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t(new Date() - createdAtDate) / (1000 * 60 * 60 * 24) > 7\r\n\t\t\t\t\t\t\t\t\t?\tgetYear(createdAtDate) === getYear(new Date())\r\n\t\t\t\t\t\t\t\t\t\t? format(createdAtDate, \"d MMMM\")\r\n\t\t\t\t\t\t\t\t\t\t: format(createdAtDate, \"d MMMM, yyyy\")\r\n\t\t\t\t\t\t\t\t\t: formatDistanceToNowStrict(createdAtDate)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<form className=\"add-comment-container\" onSubmit={handleAddComment}>\r\n\t\t\t\t\t\t<textarea className={commentLoading ? \"add-comment disabled\" : \"add-comment\"} placeholder=\"Add a comment...\" ref={addComment} onChange={() => addComment.current.value.length > 0 ? setIsInfoValid(true) : setIsInfoValid(false)} onKeyDown={handleTextareaEnter}/>\r\n\t\t\t\t\t\t<button className={`${isInfoValid ? \"text\" : \"text disabled\"}`}>Post</button>\r\n\t\t\t\t\t</form>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\telse return(\r\n\t\t<div className={`post-window outlined ${isLoading ? \"disabled\" : \"\"}`}>\r\n\t\t\t{ likesWindow\r\n\t\t\t\t? <FollowWindow title=\"Likes\" users={likesWindow} closeFollowListWindow={() => setLikesWindow(null)}/>\r\n\t\t\t\t: null\r\n\t\t\t}\r\n\t\t\t{ isDialogBoxOpen &&\r\n\t\t\t\t<div className=\"dialog-box-container\" onClick={closeDialogBox}>\r\n\t\t\t\t\t<div className=\"dialog-box\" onClick={e => e.stopPropagation()}>\r\n\t\t\t\t\t\t{currentUser && currentUser.username === post.user.username && <button className=\"remove text\" onClick={deletePost}>Delete</button>}\r\n\t\t\t\t\t\t<button className=\"cancel text\" onClick={closeDialogBox}>Cancel</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t\t<img src={post.photo} alt={post.caption}></img>\r\n\t\t\t<div className=\"side\">\r\n\t\t\t\t<div className=\"poster\">\r\n\t\t\t\t\t<Link to={`/${post.user.username}`}><div className=\"profile-pic outlined round\"><img src={post.user.profilePic} alt=\"Profile Pic\"></img></div></Link>\r\n\t\t\t\t\t<Link to={`/${post.user.username}`} className=\"username\">{post.user.username}</Link>\r\n\t\t\t\t\t<VerifiedTick size={15} user={post.user} marginLeft={7.5}/>\r\n\t\t\t\t\t{currentUser && currentUser.username === post.user.username && <button className=\"icon\" style={{width: 15, height: 15}} onClick={() => setIsDialogBoxOpen(true)}><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6 12c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3zm9 0c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3zm9 0c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3z\"/></svg></button>}\r\n\t\t\t\t\t{currentUser && currentUser.username === post.user.username ? null : <FollowButton target={post.user}></FollowButton>}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"comments\">\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t<Comment\r\n\t\t\t\t\t\t\tcommentData={{user: post.user, comment: post.caption, createdAt: post.createdAt}}\r\n\t\t\t\t\t\t\tnoLike\r\n\t\t\t\t\t\t\tnoLikesCounter\r\n\t\t\t\t\t\t\tnoRemove\r\n\t\t\t\t\t\t\tpostData={post}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpost.comments.map(comment =>\r\n\t\t\t\t\t\t\t<Comment\r\n\t\t\t\t\t\t\t\tcommentData={comment}\r\n\t\t\t\t\t\t\t\tkey={comment.id}\r\n\t\t\t\t\t\t\t\tsetLikesWindow={setLikesWindow}\r\n\t\t\t\t\t\t\t\tpostData={post}\r\n\t\t\t\t\t\t\t\trefreshComments={refreshPost}\r\n\t\t\t\t\t\t\t/>)\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"info\">\r\n\t\t\t\t\t<div className=\"interactions\">\r\n\t\t\t\t\t\t<div style={{display: \"flex\"}}>\r\n\t\t\t\t\t\t\t<Like target={post}/>\r\n\t\t\t\t\t\t\t<button className=\"comment-bubble icon\"><svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fillRule=\"evenodd\" clipRule=\"evenodd\"><path d=\"M12 1c-6.338 0-12 4.226-12 10.007 0 2.05.739 4.063 2.047 5.625l-1.993 6.368 6.946-3c1.705.439 3.334.641 4.864.641 7.174 0 12.136-4.439 12.136-9.634 0-5.812-5.701-10.007-12-10.007m0 1c6.065 0 11 4.041 11 9.007 0 4.922-4.787 8.634-11.136 8.634-1.881 0-3.401-.299-4.946-.695l-5.258 2.271 1.505-4.808c-1.308-1.564-2.165-3.128-2.165-5.402 0-4.966 4.935-9.007 11-9.007\"/></svg></button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<Save target={post}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<span className=\"likes\" onClick={() => setLikesWindow(post.likes)}><span className=\"number\">{post.likes.length}</span> likes</span>\r\n\t\t\t\t\t<span className=\"timestamp\" title={format(createdAtDate, \"d MMM, yyyy\")}>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tgetYear(createdAtDate) === getYear(new Date())\r\n\t\t\t\t\t\t\t\t? format(createdAtDate, \"d MMMM\")\r\n\t\t\t\t\t\t\t\t: format(createdAtDate, \"d MMMM, yyyy\")\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<form className=\"add-comment-container\" onSubmit={handleAddComment}>\r\n\t\t\t\t\t<textarea className={commentLoading ? \"add-comment disabled\" : \"add-comment\"} placeholder=\"Add a comment...\" ref={addComment} onChange={() => addComment.current.value.length > 0 ? setIsInfoValid(true) : setIsInfoValid(false)} onKeyDown={handleTextareaEnter}/>\r\n\t\t\t\t\t<button className={`${isInfoValid ? \"text\" : \"text disabled\"}`}>Post</button>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default PostWindow;\r\n","import { useEffect, useRef, useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { startLoading, stopLoading } from \"../state/actions/isLoading\";\r\nimport PostWindow from \"./Posts/PostWindow\";\r\nimport { backend } from \"../config\";\r\nimport { logOut } from \"../helpers\";\r\nimport { useHistory } from \"react-router-dom/cjs/react-router-dom.min\";\r\n\r\nconst HomePage = () =>\r\n{\r\n\tconst postsRef = useRef();\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\t// const [scroll, setScroll] = useState(0);\r\n\tconst [olderPosts, setOlderPosts] = useState(null);\r\n\tconst [postsToDisplay, setPostsToDisplay] = useState(null);\r\n\r\n\t// const handleScroll = () =>\r\n\t// {\r\n\t// \tconst winScroll = document.body.scrollTop || document.documentElement.scrollTop;\r\n\t// \tconst height = document.documentElement.scrollHeight - document.documentElement.clientHeight;\r\n  \t// setScroll(winScroll / height * 100);\r\n\t// };\r\n\t// useEffect(handleScroll, []);\r\n\r\n\tuseEffect(() => document.title = \"Instadicey\", []);\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tconst getPosts = async () =>\r\n\t\t{\r\n\t\t\tif (!localStorage.token) return;\r\n\t\t\tdispatch(startLoading());\r\n\t\t\ttry {\r\n\t\t\t\tconst result = await fetch(`${backend}/user/feed`, {\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (result.status === 401)\r\n\t\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\t\tconst resultJSON = await result.json();\r\n\t\t\t\tif (!result.ok)\r\n\t\t\t\t\tthrow new Error(resultJSON.detail);\r\n\r\n\t\t\t\tconst threeDaysAgo = new Date();\r\n  \t\t\t\tthreeDaysAgo.setUTCDate(threeDaysAgo.getUTCDate() - 3);\r\n\t\t\t\tsetPostsToDisplay(resultJSON.filter(p => new Date(p.createdAt+\"Z\") >= threeDaysAgo));\r\n\t\t\t\tsetOlderPosts(resultJSON.filter(p => new Date(p.createdAt+\"Z\") < threeDaysAgo));\r\n\t\t\t} catch {\r\n\r\n\t\t\t}\r\n\t\t\tdispatch(stopLoading());\r\n\t\t};\r\n\t\tgetPosts();\r\n\t}, [dispatch, history]);\r\n\r\n\t// useEffect(() =>\r\n\t// {\r\n\t// \twindow.addEventListener(\"scroll\", handleScroll);\r\n\t// \treturn () =>\r\n\t// \t{\r\n\t// \t\twindow.removeEventListener(\"scroll\", handleScroll);\r\n\t// \t};\r\n\t// }, [postsRef]);\r\n\r\n\tif (!postsToDisplay) return null;\r\n\treturn(\r\n\t\t<div className=\"home-page\">\r\n\t\t\t{\r\n\t\t\t\tpostsToDisplay &&\r\n\t\t\t\t<div className=\"posts\" ref={postsRef}>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpostsToDisplay.map(post =>\r\n\t\t\t\t\t\t\t<PostWindow post={post} isVertical key={post.id}/>)\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t\t{ olderPosts &&\r\n\t\t\t\t\t<div className=\"older-posts posts\" ref={postsRef}>\r\n\t\t\t\t\t\t<h2>Showing posts older than 3 days</h2>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tolderPosts.map(post =>\r\n\t\t\t\t\t\t\t\t<PostWindow post={post} isVertical key={post.id}/>)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default HomePage;\r\n","import { useEffect } from \"react\";\r\n\r\nconst BrokenPage = () =>\r\n{\r\n\tuseEffect(() => document.title = \"Page Not Found • Instadicey\", []);\r\n\r\n\treturn(\r\n\t\t<div id=\"broken-page\">\r\n\t\t\t<h1>Sorry, this page isn't available.</h1>\r\n\t\t\t<h2>The link you followed may be broken, or the page may have been removed.</h2>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default BrokenPage;\r\n","import { useState } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport Loading from \"../../assets/misc/loading.jpg\";\r\n\r\nconst PostCard = ({post}) =>\r\n{\r\n\tconst [isHovered, setIsHovered] = useState(false);\r\n\r\n\r\n\tif (!post) return <div className=\"post-card loading outlined\"><div className=\"container\"><img src={Loading} alt=\"loading\" style={{height: \"25%\", position: \"absolute\", inset: 0, margin: \"auto\"}}></img></div></div>;\r\n\telse return(\r\n\t\t<div className=\"post-card\" onMouseOver={() => setIsHovered(true)} onMouseLeave={() => setIsHovered(false)}>\r\n\t\t\t<div className=\"container\">\r\n\t\t\t\t<Link to={`/p/${post.id}`}>\r\n\t\t\t\t\t{ isHovered &&\r\n\t\t\t\t\t\t<div className=\"hovered\">\r\n\t\t\t\t\t\t\t<span><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\"><path d=\"M12 4.248c-3.148-5.402-12-3.825-12 2.944 0 4.661 5.571 9.427 12 15.808 6.43-6.381 12-11.147 12-15.808 0-6.792-8.875-8.306-12-2.944z\"></path></svg> {post.likesCount}</span>\r\n\t\t\t\t\t\t\t<span><svg xmlns=\"http://www.w3.org/2000/svg\" className=\"comment-bubble\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\"><path d=\"M.054 23c.971-1.912 2.048-4.538 1.993-6.368-1.308-1.562-2.047-3.575-2.047-5.625 0-5.781 5.662-10.007 12-10.007 6.299 0 12 4.195 12 10.007 0 6.052-6.732 11.705-15.968 9.458-1.678 1.027-5.377 2.065-7.978 2.535z\"/></svg> {post.commentsCount}</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<img src={post.photo} alt={post.caption}></img>\r\n\t\t\t\t</Link>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default PostCard;\r\n","import { useEffect, useState } from \"react\";\r\nimport { Route, Switch, useParams } from \"react-router\";\r\nimport { Link, NavLink } from \"react-router-dom\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { startLoading, stopLoading } from \"../state/actions/isLoading\";\r\nimport { useHistory } from \"react-router-dom/cjs/react-router-dom.min.js\";\r\nimport { backend } from \"../config.js\";\r\nimport { logOut } from \"../helpers.js\";\r\nimport BrokenPage from \"./BrokenPage\";\r\nimport FollowButton from \"./FollowButton\";\r\nimport FollowWindow from \"./FollowWindow\";\r\nimport PostCard from \"./Posts/PostCard\";\r\nimport VerifiedTick from \"./VerifiedTick\";\r\nimport \"../styles/user-profile.css\";\r\n\r\nconst UserProfile = () =>\r\n{\r\n\tconst { username } = useParams();\r\n\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\tconst [userData, setUserData] = useState(null);\r\n\tconst [savedPosts, setSavedPosts] = useState(null);\r\n\tconst [isFollowingListWindowOpen, setIsFollowingListWindowOpen] = useState(false);\r\n\tconst [isFollowersListWindowOpen, setIsFollowersListWindowOpen] = useState(false);\r\n\tconst closeFollowListWindow = () =>\r\n\t{\r\n\t\tsetIsFollowingListWindowOpen(false);\r\n\t\tsetIsFollowersListWindowOpen(false);\r\n\t};\r\n\r\n\tconst getUserData = async () =>\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tconst result = await fetch(`${backend}/user/${username}`);\r\n\t\t\tconst resultJSON = await result.json();\r\n\t\t\tif (!result.ok)\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\r\n\t\t\tsetUserData(resultJSON);\r\n\t\t\tif (currentUser && currentUser.username === resultJSON.username)\r\n\t\t\t\ttry\r\n\t\t\t\t{\r\n\t\t\t\t\tconst savedPostsResult = await fetch(`${backend}/user/saved-posts`, {\r\n\t\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t\tAuthorization: `Bearer ${localStorage.getItem(\"token\")}`\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (savedPostsResult.status === 401)\r\n\t\t\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst savedPostsResultJSON = await savedPostsResult.json();\r\n\t\t\t\t\tif (!savedPostsResult.ok)\r\n\t\t\t\t\t\tthrow new Error(savedPostsResultJSON.detail, savedPostsResultJSON.errors);\r\n\t\t\t\t\t\r\n\t\t\t\t\tsetSavedPosts(savedPostsResultJSON);\r\n\t\t\t\t}\r\n\t\t\t\tcatch\r\n\t\t\t\t{\r\n\t\t\t\t\tsetSavedPosts(null);\r\n\t\t\t\t}\r\n\t\t}\r\n\t\tcatch (err)\r\n\t\t{\r\n\t\t\treturn setUserData(false);\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tcloseFollowListWindow();\r\n\r\n\t\tconst getData = async () =>\r\n\t\t{\r\n\t\t\tdispatch(startLoading());\r\n\t\t\tawait getUserData();\r\n\t\t\tdispatch(stopLoading());\r\n\t\t};\r\n\t\tgetData();\r\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t}, [username]);\r\n\t\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tif (!userData) return;\r\n\t\tuserData.realName\r\n\t\t\t? document.title = `${userData.realName} (@${userData.username}) • Instadicey`\r\n\t\t\t: document.title = `@${userData.username} • Instadicey`;\r\n\t}, [userData]);\r\n\r\n\tif (userData === false) return <BrokenPage/>;\r\n\telse if (!userData) return null;\r\n\telse return(\r\n\t\t<div className=\"user-profile\">\r\n\t\t\t{ isFollowingListWindowOpen\r\n\t\t\t\t? <FollowWindow title=\"Following\" users={userData.following} closeFollowListWindow={closeFollowListWindow}/>\r\n\t\t\t\t: isFollowersListWindowOpen\r\n\t\t\t\t\t? <FollowWindow title=\"Followers\" users={userData.followers} closeFollowListWindow={closeFollowListWindow}/>\r\n\t\t\t\t\t: null\r\n\t\t\t}\r\n\t\t\t<div className=\"upper\">\r\n\t\t\t\t<div className=\"personal-info\">\r\n\t\t\t\t\t<div className=\"profile-pic\"><img src={userData.profilePic} alt={`${username}'s profile pic`}></img></div>\r\n\t\t\t\t\t<div className=\"info\">\r\n\t\t\t\t\t\t<div className=\"name\">\r\n\t\t\t\t\t\t\t{userData.username}\r\n\t\t\t\t\t\t\t<VerifiedTick user={userData}/>\r\n\t\t\t\t\t\t\t{ currentUser\r\n\t\t\t\t\t\t\t\t? userData.username === currentUser.username\r\n\t\t\t\t\t\t\t\t\t? <Link to=\"/accounts/edit\" className=\"edit-profile-btn outlined\">Edit Profile</Link>\r\n\t\t\t\t\t\t\t\t\t: <FollowButton target={userData}/>\r\n\t\t\t\t\t\t\t\t: <FollowButton target={userData}/>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"follow\">\r\n\t\t\t\t\t\t\t<span className=\"posts\"><span className=\"number\">{userData.posts.length}</span> posts</span>\r\n\t\t\t\t\t\t\t<span className=\"followers\" onClick={() => setIsFollowersListWindowOpen(true)}><span className=\"number\">{userData.followers.length}</span> followers</span>\r\n\t\t\t\t\t\t\t<span className=\"following\" onClick={() => setIsFollowingListWindowOpen(true)}><span className=\"number\">{userData.following.length}</span> following</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"bio\">\r\n\t\t\t\t\t\t\t<span className=\"real-name\">{userData.realName}</span>\r\n\t\t\t\t\t\t\t<div className=\"bio-text\">{userData.bio}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<nav>\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t<li><NavLink exact to={`/${userData.username}`} activeClassName=\"selected\"><svg xmlns=\"http://www.w3.org/2000/svg\" className=\"icon\" viewBox=\"0 0 24 24\"><path d=\"M6 6h-6v-6h6v6zm9-6h-6v6h6v-6zm9 0h-6v6h6v-6zm-18 9h-6v6h6v-6zm9 0h-6v6h6v-6zm9 0h-6v6h6v-6zm-18 9h-6v6h6v-6zm9 0h-6v6h6v-6zm9 0h-6v6h6v-6z\"/></svg> POSTS</NavLink></li>\r\n\t\t\t\t\t{currentUser && currentUser.username === userData.username && <li><NavLink exact to={`/${userData.username}/saved`} activeClassName=\"selected\"><svg xmlns=\"http://www.w3.org/2000/svg\" className=\"icon\" viewBox=\"0 0 24 24\"><path d=\"M16 2v17.582l-4-3.512-4 3.512v-17.582h8zm2-2h-12v24l6-5.269 6 5.269v-24z\"/></svg> SAVED</NavLink></li>}\r\n\t\t\t\t</ul>\r\n\t\t\t</nav>\r\n\t\t\t<Switch>\r\n\t\t\t\t<Route exact path=\"/:username\">\r\n\t\t\t\t\t<div className=\"post-cards-container\">\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tuserData.posts.map(post =>\r\n\t\t\t\t\t\t\t\t<PostCard post={post} key={post.id}/>)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</Route>\r\n\t\t\t\t<Route exact path=\"/:username/saved\">\r\n\t\t\t\t\t<div className=\"post-cards-container\">\r\n\t\t\t\t\t\t{ savedPosts &&\r\n\t\t\t\t\t\t\tsavedPosts.map(post =>\r\n\t\t\t\t\t\t\t\t<PostCard post={post} key={post.id}/>)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</Route>\r\n\t\t\t</Switch>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default UserProfile;\r\n","import { useEffect, useRef, useState } from \"react\";\r\nimport { useHistory } from \"react-router\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport store from \"../../state\";\r\nimport { startLoading, stopLoading } from \"../../state/actions/isLoading\";\r\nimport { setNewPost } from \"../../state/actions/newPost\";\r\nimport { setSnackbar } from \"../../state/actions/snackbar\";\r\nimport Cropper from \"react-easy-crop\";\r\nimport { backend } from \"../../config\";\r\nimport { logOut } from \"../../helpers\";\r\n\r\nconst NewPost = () =>\r\n{\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\tconst photo = useSelector(state => state.newPost);\r\n\tconst [photoUrl, setPhotoUrl] = useState(\"\");\r\n\tconst [crop, setCrop] = useState({ x: 0, y: 0 });\r\n\tconst [zoom, setZoom] = useState(1);\r\n\tconst [rotation, setRotation] = useState(0);\r\n\tconst [croppedAreaPixels, setCroppedAreaPixels] = useState(null);\r\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\tuseEffect(() => currentUser ? dispatch(stopLoading()) : dispatch(startLoading()), [photoUrl, currentUser]);\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tif (!photo) return;\r\n\t\tconst reader = new FileReader();\r\n\t\treader.readAsDataURL(photo);\r\n\t\treader.onloadend = () => setPhotoUrl(reader.result);\r\n\t}, [photo]);\r\n\r\n\tconst captionRef = useRef();\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tconst photo = store.getState().newPost;\r\n\t\tif (!photo) return history.push(\"/\");\r\n\r\n\t\treturn () => dispatch(setNewPost(null));\r\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t},[]);\r\n\r\n\tconst { getCroppedImg } = foo;\r\n\r\n\tconst cancel = () => history.push(\"/\");\r\n\r\n\tconst share = async () =>\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tdispatch(startLoading());\r\n\t\t\tconst caption = captionRef.current.value;\r\n\t\t\tconst croppedPhoto = await getCroppedImg(photoUrl, croppedAreaPixels, rotation);\r\n\t\t\tconst formData = new FormData();\r\n\t\t\tformData.append(\"caption\", caption);\r\n\t\t\tformData.append(\"photo\", croppedPhoto, photo.name);\r\n\t\t\tconst result = await fetch(`${backend}/post/create`, {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t},\r\n\t\t\t\tbody: formData\r\n\t\t\t});\r\n\t\t\tconst resultJSON = await result.json();\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\r\n\t\t\tif (!result.ok)\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\r\n\t\t\tdispatch(setSnackbar(\"Post uploaded.\", \"success\"));\r\n\t\t\thistory.push(`/p/${resultJSON.id}`);\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tdispatch(setSnackbar(err.message ?? \"Oops, try again later.\", \"error\"));\r\n\t\t}\r\n\t\tdispatch(stopLoading());\r\n\t};\r\n\r\n\tif (!currentUser || !photoUrl) return null;\r\n\treturn(\r\n\t\t<div className=\"new-post\">\r\n\t\t\t<div className=\"header\">\r\n\t\t\t\t<button className=\"cancel text\" onClick={cancel}><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" className=\"bi bi-x-lg\" viewBox=\"0 0 16 16\"><path d=\"M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z\"/></svg></button>\r\n\t\t\t\tNew Photo Post\r\n\t\t\t\t<button className=\"text\" onClick={share}>Share</button>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"cropper-container\">\r\n\t\t\t\t<Cropper\r\n\t\t\t\t\timage={photoUrl}\r\n\t\t\t\t\tcrop={crop}\r\n\t\t\t\t\tzoom={zoom}\r\n\t\t\t\t\tzoomSpeed={0.5}\r\n\t\t\t\t\tonCropChange={setCrop}\r\n\t\t\t\t\tonZoomChange={setZoom}\r\n\t\t\t\t\tonRotationChange={setRotation}\r\n\t\t\t\t\tonCropComplete={(croppedArea, croppedAreaPixels) => setCroppedAreaPixels(croppedAreaPixels)}\r\n\t\t\t\t\taspect={1}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"caption-container outlined\">\r\n\t\t\t\t<div className=\"profile-pic outlined round\"><img src={currentUser.profilePic} alt=\"profile pic\"></img></div>\r\n\t\t\t\t<textarea className=\"caption\" placeholder=\"Write a caption...\" ref={captionRef}></textarea>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nconst foo = (() =>\r\n{\r\n\tconst createImage = url =>\r\n\t\tnew Promise((resolve, reject) => {\r\n\t\t\tconst image = new Image();\r\n\t\t\timage.addEventListener(\"load\", () => resolve(image));\r\n\t\t\timage.addEventListener(\"error\", error => reject(error));\r\n\t\t\timage.setAttribute(\"crossOrigin\", \"anonymous\"); // needed to avoid cross-origin issues on CodeSandbox\r\n\t\t\timage.src = url;\r\n\t\t});\r\n\r\n\tfunction getRadianAngle(degreeValue) {\r\n\t\treturn (degreeValue * Math.PI) / 180;\r\n\t}\r\n\r\n\t/**\r\n\t * This function was adapted from the one in the ReadMe of https://github.com/DominicTobias/react-image-crop\r\n\t * @param {File} image - Image File url\r\n\t * @param {Object} pixelCrop - pixelCrop Object provided by react-easy-crop\r\n\t * @param {number} rotation - optional rotation parameter\r\n\t */\r\n\tconst getCroppedImg = async (imageSrc, pixelCrop, rotation = 0) => {\r\n\t\tconst image = await createImage(imageSrc);\r\n\t\tconst canvas = document.createElement(\"canvas\");\r\n\t\tconst ctx = canvas.getContext(\"2d\");\r\n\r\n\t\tconst maxSize = Math.max(image.width, image.height);\r\n\t\tconst safeArea = 2 * ((maxSize / 2) * Math.sqrt(2));\r\n\r\n\t\t// set each dimensions to double largest dimension to allow for a safe area for the\r\n\t\t// image to rotate in without being clipped by canvas context\r\n\t\tcanvas.width = safeArea;\r\n\t\tcanvas.height = safeArea;\r\n\r\n\t\t// translate canvas context to a central location on image to allow rotating around the center.\r\n\t\tctx.translate(safeArea / 2, safeArea / 2);\r\n\t\tctx.rotate(getRadianAngle(rotation));\r\n\t\tctx.translate(-safeArea / 2, -safeArea / 2);\r\n\r\n\t\t// draw rotated image and store data.\r\n\t\tctx.drawImage(\r\n\t\t\timage,\r\n\t\t\tsafeArea / 2 - image.width * 0.5,\r\n\t\t\tsafeArea / 2 - image.height * 0.5\r\n\t\t);\r\n\t\tconst data = ctx.getImageData(0, 0, safeArea, safeArea);\r\n\r\n\t\t// set canvas width to final desired crop size - this will clear existing context\r\n\t\tcanvas.width = pixelCrop.width;\r\n\t\tcanvas.height = pixelCrop.height;\r\n\r\n\t\t// paste generated rotate image with correct offsets for x,y crop values.\r\n\t\tctx.putImageData(\r\n\t\t\tdata,\r\n\t\t\tMath.round(0 - safeArea / 2 + image.width * 0.5 - pixelCrop.x),\r\n\t\t\tMath.round(0 - safeArea / 2 + image.height * 0.5 - pixelCrop.y)\r\n\t\t);\r\n\r\n\t\t// As Base64 string\r\n\t\t// return canvas.toDataURL(\"image/jpeg\");\r\n\t\t// As a blob\r\n\t\treturn new Promise(resolve => canvas.toBlob(file => resolve(file), \"image/png\"));\r\n\t};\r\n\r\n\treturn { getCroppedImg };\r\n})();\r\n\r\nexport default NewPost;\r\n","import { useEffect, useState } from \"react\";\r\nimport { useParams } from \"react-router\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { startLoading, stopLoading } from \"../../state/actions/isLoading\";\r\nimport PostWindow from \"./PostWindow\";\r\nimport PostCard from \"./PostCard\";\r\nimport BrokenPage from \"../BrokenPage\";\r\nimport \"./post-page.css\";\r\nimport { backend } from \"../../config\";\r\n\r\nconst PostPage = () =>\r\n{\r\n\tconst { postID } = useParams();\r\n\tconst dispatch = useDispatch();\r\n\tconst [postData, setPostData] = useState(null);\r\n\tconst [morePosts, setMorePosts] = useState(null);\r\n\tconst [isSmallScreen, setIsSmallScreen] = useState(false);\r\n\tconst handleResize = () => window.innerWidth < 1024 ? setIsSmallScreen(true) : setIsSmallScreen(false);\r\n\tuseEffect(() =>\r\n\t{\r\n\t\thandleResize();\r\n\t\twindow.addEventListener(\"resize\", handleResize);\r\n\t\treturn () => window.removeEventListener(\"resize\", handleResize);\r\n\t}, []);\r\n\r\n\tuseEffect(() => document.title = \"Instadicey\", []);\r\n\r\n\tconst getPostData = async () =>\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tconst result = await fetch(`${backend}/post/${postID}`);\r\n\t\t\tconst resultJSON = await result.json();\r\n\r\n\t\t\tif (!result.ok)\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\r\n\t\t\t// Required because JS UTC dates have to end with Z\r\n\t\t\t// resultJSON.comments =resultJSON.comments.map(c => {\r\n\t\t\t// \tconst newComment = {...c, createdAt: c.createdAt + \"Z\"};\r\n\t\t\t// \treturn newComment;\r\n\t\t\t// });\r\n\t\t\tsetPostData(resultJSON);\r\n\t\t\tawait getMorePosts();\r\n\t\t} catch (err)\r\n\t\t{\r\n\t\t\tconsole.error(err);\r\n\t\t}\r\n\t};\r\n\r\n\tconst getMorePosts = async () =>\r\n\t{\r\n\t\ttry {\r\n\t\t\tconst result = await fetch(`${backend}/post/${postID}/more`);\r\n\t\t\tconst resultJSON = await result.json();\r\n\t\t\tif (!result.ok)\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\r\n\t\t\tsetMorePosts(resultJSON);\r\n\t\t} catch {\r\n\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tconst getData = async () => {\r\n\t\t\tdispatch(startLoading());\r\n\t\t\tawait getPostData();\r\n\t\t\tdispatch(stopLoading());\r\n\t\t};\r\n\t\tgetData();\r\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t}, [postID]);\r\n\r\n\tif (!postData) return <BrokenPage/>;\r\n\telse return(\r\n\t\t<div className=\"post-page\">\r\n\t\t\t{\r\n\t\t\t\tisSmallScreen\r\n\t\t\t\t\t? <PostWindow post={postData} refreshPost={getPostData} isVertical/>\r\n\t\t\t\t\t: <PostWindow post={postData} refreshPost={getPostData} />\r\n\t\t\t}\r\n\t\t\t<div className=\"more-posts\">\r\n\t\t\t\t<header>More posts from this user</header>\r\n\t\t\t\t{ morePosts &&\r\n\t\t\t\t\t<div className=\"post-cards-container\">\r\n\t\t\t\t\t\t{ morePosts.map(post => <PostCard post={post} key={post.id}/>) }\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default PostPage;\r\n","import { Link } from \"react-router-dom\";\r\n\r\nconst Message = ({messageInfo, noPhoto, isSent}) =>\r\n{\r\n\treturn(\r\n\t\t<div className={`message ${isSent ? \"sent\" : \"\"}`}>\r\n\t\t\t{ noPhoto\r\n\t\t\t\t? <span className=\"dummy\" style={{width: 32, height: 32}}></span>\r\n\t\t\t\t: <Link to={`/${messageInfo.user.username}`} className=\"profile-pic\"><img src={messageInfo.user.profilePic} alt={`${messageInfo.user.username}'s profile pic`}></img></Link>\r\n\t\t\t}\r\n\t\t\t<span className=\"text outlined round\">{messageInfo.message}</span>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default Message;\r\n","import { useEffect, useRef, useState } from \"react\";\r\nimport { useHistory } from \"react-router\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport * as signalR from \"@microsoft/signalr\";\r\nimport Message from \"./Message\";\r\nimport { backend } from \"../../config\";\r\nimport { logOut } from \"../../helpers\";\r\nimport { setSnackbar } from \"../../state/actions/snackbar\";\r\n\r\nconst Room = ({roomID}) =>\r\n{\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\tconst messageRef = useRef();\r\n\tconst [roomInfo, setRoomInfo] = useState(null);\r\n\tconst [messages, setMessages] = useState(null);\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [connection, setConnection] = useState(null);\r\n\r\n\tconst getRoomInfo = async () => {\r\n\t\ttry {\r\n\t\t\tconst result = await fetch(`${backend}/chat/room?roomID=${roomID}`, {\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\tconst resultJSON = await result.json();\r\n\t\t\tif (!result.ok)\r\n\t\t\t\tthrow new Error(resultJSON.detail);\r\n\t\t\tsetRoomInfo(resultJSON);\r\n\t\t} catch (err) {\r\n\t\t\tdispatch(setSnackbar(err.message, \"error\"));\r\n\t\t}\r\n\t};\r\n\r\n\tconst getMessages = async () =>\r\n\t{\r\n\t\ttry {\r\n\t\t\tconst result = await fetch(`${backend}/chat/messages?roomID=${roomID}`, {\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\tconst resultJSON = await result.json();\r\n\t\t\tif (!result.ok)\r\n\t\t\t\tthrow new Error(resultJSON.detail);\r\n\t\t\tsetMessages(resultJSON);\r\n\t\t} catch (err) {\r\n\t\t\tdispatch(setSnackbar(err.message, \"error\"));\r\n\t\t}\r\n\t};\r\n\r\n\tconst sendMessage = async e =>\r\n\t{\r\n\t\te.preventDefault();\r\n\t\ttry\r\n\t\t{\r\n\t\t\tsetIsLoading(true);\r\n\t\t\tconst message = messageRef.current.value;\r\n\t\t\tif (message.trim() === \"\") throw new Error(\"Message is empty\");\r\n\r\n\t\t\tawait connection.invoke(\"SendMessage\", message);\r\n\r\n\t\t\tmessageRef.current.value = \"\";\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t}\r\n\t\tsetIsLoading(false);\r\n\t};\r\n\r\n\tuseEffect(() => document.title = \"Instadicey • Chats\");\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tconst signalRConnection = new signalR.HubConnectionBuilder().withUrl(`${backend}/chat-hub?roomID=${roomID}`, { accessTokenFactory: () => localStorage.token }).withAutomaticReconnect().build();\r\n\t\tsignalRConnection.start().then(() => {\r\n\t\t\tsetConnection(signalRConnection);\r\n\t\t\tsignalRConnection.on(\"ReceiveMessage\", msg => setMessages(prev => [...prev, msg]));\r\n\t\t}).catch(err => {\r\n\t\t\tif (err.statusCode === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t});\r\n\r\n\t\treturn () => signalRConnection.stop();\r\n\t}, [roomID, dispatch, history]);\r\n\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tconst getData = async () =>\r\n\t\t{\r\n\t\t\tawait getRoomInfo();\r\n\t\t\tawait getMessages();\r\n\t\t};\r\n\t\tgetData();\r\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t}, [roomID]);\r\n\r\n\tif (!messages || !connection) return null;\r\n\treturn(\r\n\t\t<div className=\"chat-room\">\r\n\t\t\t<header><Link to={`/${roomInfo.users[0].username}`} style={{display: \"flex\", alignItems: \"center\"}}><span className=\"profile-pic\" style={{marginRight: \"1rem\"}}><img src={roomInfo.users[0].profilePic} alt={`${roomInfo.users[0].username}'s pic`}></img></span>{roomInfo.users[0].username}</Link></header>\r\n\t\t\t<div className=\"messages\">\r\n\t\t\t\t<div className=\"container\">\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tmessages.map((message, i, messagesArray) => \r\n\t\t\t\t\t\t\tmessage.user.username === currentUser.username \r\n\t\t\t\t\t\t\t\t? <Message messageInfo={message} noPhoto isSent key={message.id}/> \r\n\t\t\t\t\t\t\t\t: messagesArray[i + 1] \r\n\t\t\t\t\t\t\t\t\t? messagesArray[i].user.username === messagesArray[i + 1].user.username\r\n\t\t\t\t\t\t\t\t\t\t? <Message messageInfo={message} noPhoto key={message.id}/>\r\n\t\t\t\t\t\t\t\t\t\t: <Message messageInfo={message} key={message.id}/>\r\n\t\t\t\t\t\t\t\t\t: <Message messageInfo={message} key={message.id}/>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"send-message-container\">\r\n\t\t\t\t<form className=\"outlined round\" onSubmit={sendMessage}>\r\n\t\t\t\t\t<input className={`${isLoading ? \"disabled\" : \"\"}`} placeholder=\"Message...\" ref={messageRef}/>\r\n\t\t\t\t\t<button className=\"text\">Send</button>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default Room;\r\n","export default __webpack_public_path__ + \"static/media/send-message.3a6be95e.png\";","import { useEffect, useState } from \"react\";\r\nimport { Route, useParams } from \"react-router\";\r\nimport { NavLink, Switch } from \"react-router-dom\";\r\nimport { useMediaQuery } from \"react-responsive\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { formatDistanceToNowStrict } from \"date-fns\";\r\nimport * as signalR from \"@microsoft/signalr\";\r\nimport Room from \"./Room\";\r\nimport FollowWindow from \"../FollowWindow\";\r\nimport SendMessage from \"../../assets/misc/send-message.png\";\r\nimport \"./inbox.css\";\r\nimport { backend } from \"../../config\";\r\nimport { logOut } from \"../../helpers\";\r\nimport { useHistory } from \"react-router-dom/cjs/react-router-dom.min\";\r\nimport { setSnackbar } from \"../../state/actions/snackbar\";\r\nimport { startLoading, stopLoading } from \"../../state/actions/isLoading\";\r\n\r\nconst Inbox = () =>\r\n{\r\n\tconst { roomID } = useParams();\r\n\tconst currentUser = useSelector(state => state.currentUser);\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\tconst [currentUserFollows, setCurrentUserFollows] = useState(null);\r\n\tconst [recentChats, setRecentChats] = useState(null);\r\n\tconst [isNewMessageBoxOpen, setIsNewMessageBoxOpen] = useState(false);\r\n\tconst closeNewMessageBox = () => setIsNewMessageBoxOpen(false);\r\n\tconst phoneQuery = useMediaQuery({query: \"(max-width: 600px)\"});\r\n\r\n\tuseEffect(() => document.title = \"Inbox • Chats\");\r\n\r\n\tconst formatDate = date =>\r\n\t{\r\n\t\tlet dateStringArray = date.split(\" \");\r\n\t\tdateStringArray[1] = dateStringArray[1].slice(0, 1);\r\n\t\tconst dateString = dateStringArray.join(\" \");\r\n\t\treturn dateString;\r\n\t};\r\n\r\n\tconst getChats = async () =>\r\n\t{\r\n\t\tif (!currentUser) return;\r\n\t\ttry {\r\n\t\t\tconst result = await fetch(`${backend}/chat/rooms`, {\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${localStorage.token}`\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (result.status === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t\tconst resultJSON = await result.json();\r\n\t\t\tif (!result.ok)\r\n\t\t\t\tthrow new Error(resultJSON.detail);\r\n\r\n\t\t\tsetRecentChats(resultJSON);\r\n\t\t} catch(err) {\r\n\t\t\tconsole.error(err);\r\n\t\t}\r\n\t};\r\n\r\n\tconst getUsersFollows = async () =>\r\n\t{\r\n\t\tif (!currentUser) return;\r\n\t\ttry {\r\n\t\t\tconst result = await fetch(`${backend}/user/${currentUser.username}`);\r\n\t\t\tconst resultJSON = await result.json();\r\n\t\t\tif (!result.ok)\r\n\t\t\t\tthrow new Error(resultJSON.detail, { cause: resultJSON.errors });\r\n\t\t\tconst followingAndFollowers = [...resultJSON.following, ...resultJSON.followers];\r\n\t\t\tsetCurrentUserFollows([...new Map(followingAndFollowers.map(u => [u.username, u])).values()]);\r\n\t\t} catch (err) {\r\n\t\t\tdispatch(setSnackbar(err.message));\r\n\t\t}\r\n\t};\r\n\t\r\n\tuseEffect(() => {\r\n\t\tif (!currentUser) return;\r\n\t\tconst getData = async () => {\r\n\t\t\tdispatch(startLoading());\r\n\t\t\tawait getUsersFollows();\r\n\t\t\tawait getChats();\r\n\t\t\tdispatch(stopLoading());\r\n\t\t};\r\n\t\tgetData();\r\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t}, [currentUser]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!currentUser) return;\r\n\t\tconst connection = new signalR.HubConnectionBuilder().withUrl(`${backend}/chat-hub`, { accessTokenFactory: () => localStorage.token }).withAutomaticReconnect().build();\r\n\t\tconnection.start().then(() => {\r\n\t\t\tconnection.on(\"UpdateRoom\", chatRoom => {\r\n\t\t\t\tvar found = false;\r\n\t\t\t\tchatRoom.users = chatRoom.users.filter(u => u.username !== currentUser.username);\r\n\t\t\t\tsetRecentChats(prev => prev.map(c => {\r\n\t\t\t\t\tif (c.id === chatRoom.id) {\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\treturn chatRoom;\r\n\t\t\t\t\t} else return c;\r\n\t\t\t\t}));\r\n\t\t\t\tif (!found)\r\n\t\t\t\t\tsetRecentChats(prev => [...prev, chatRoom]);\r\n\t\t\t});\r\n\t\t\treturn () => connection.stop();\r\n\t\t}).catch(err => {\r\n\t\t\tif (err.statusCode === 401)\r\n\t\t\t\treturn logOut(dispatch, history);\r\n\t\t});\r\n\r\n\t\treturn () => connection.stop();\r\n\t}, [currentUser, dispatch, history]);\r\n\r\n\tif (!currentUser || !recentChats) return null;\r\n\tif (phoneQuery)\r\n\t\treturn(\r\n\t\t\t<div className=\"inbox-window outlined\">\r\n\t\t\t\t{ isNewMessageBoxOpen &&\r\n\t\t\t\t\t\t<FollowWindow title=\"New Message\" users={currentUserFollows} closeFollowListWindow={closeNewMessageBox} newMessage/>\r\n\t\t\t\t}\r\n\t\t\t\t<div className=\"container\">\r\n\t\t\t\t\t<Switch>\r\n\t\t\t\t\t\t<Route exact path=\"/direct/inbox\">\r\n\t\t\t\t\t\t\t<div className=\"recent-chats left\">\r\n\t\t\t\t\t\t\t\t<header>{currentUser.username}<button className=\"icon\" onClick={() => setIsNewMessageBoxOpen(true)}><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fillRule=\"evenodd\" clipRule=\"evenodd\"><path d=\"M8.071 21.586l-7.071 1.414 1.414-7.071 14.929-14.929 5.657 5.657-14.929 14.929zm-.493-.921l-4.243-4.243-1.06 5.303 5.303-1.06zm9.765-18.251l-13.3 13.301 4.242 4.242 13.301-13.3-4.243-4.243z\"/></svg></button></header>\r\n\t\t\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\trecentChats.sort((a, b) => new Date(b.lastUpdated) - new Date(a.lastUpdated)).map(chat =>\r\n\t\t\t\t\t\t\t\t\t\t\t<NavLink to={`/direct/t/${chat.id}`} activeClassName=\"selected\" key={chat.id}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<li key={chat.id}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"profile-pic\"><img src={chat.users[0].profilePic} alt={`${chat.users[0].username}'s profile pic`}></img></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"info\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"username\">{chat.users[0].username}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"message\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div>{chat.lastMessage?.message}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{chat.lastUpdated && <span>• {formatDate(formatDistanceToNowStrict(new Date(chat.lastUpdated+\"Z\")))}</span>}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t\t\t</NavLink>\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t<Route path=\"/direct/t/:roomID\">\r\n\t\t\t\t\t\t\t<Room roomID={roomID}/>\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t</Switch>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\telse return(\r\n\t\t<div className=\"inbox-window outlined\">\r\n\t\t\t{ isNewMessageBoxOpen &&\r\n\t\t\t\t\t<FollowWindow title=\"New Message\" users={currentUserFollows} closeFollowListWindow={closeNewMessageBox} newMessage/>\r\n\t\t\t}\r\n\t\t\t<div className=\"container\">\r\n\t\t\t\t<div className=\"recent-chats left\">\r\n\t\t\t\t\t<header>{currentUser.username}<button className=\"icon\" onClick={() => setIsNewMessageBoxOpen(true)}><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fillRule=\"evenodd\" clipRule=\"evenodd\"><path d=\"M8.071 21.586l-7.071 1.414 1.414-7.071 14.929-14.929 5.657 5.657-14.929 14.929zm-.493-.921l-4.243-4.243-1.06 5.303 5.303-1.06zm9.765-18.251l-13.3 13.301 4.242 4.242 13.301-13.3-4.243-4.243z\"/></svg></button></header>\r\n\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\trecentChats.sort((a, b) => new Date(b.lastUpdated) - new Date(a.lastUpdated)).map(chat =>\r\n\t\t\t\t\t\t\t\t<NavLink to={`/direct/t/${chat.id}`} activeClassName=\"selected\" key={chat.id}>\r\n\t\t\t\t\t\t\t\t\t<li key={chat.id}>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"profile-pic\"><img src={chat.users[0].profilePic} alt={`${chat.users[0].username}'s profile pic`}></img></span>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"info\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"username\">{chat.users[0].username}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"message\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div>{chat.lastMessage?.message}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{chat.lastUpdated && <span>• {formatDate(formatDistanceToNowStrict(new Date(chat.lastUpdated)))}</span>}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t</NavLink>\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"chat-window right\">\r\n\t\t\t\t\t<Switch>\r\n\t\t\t\t\t\t<Route exact path=\"/direct/inbox\">\r\n\t\t\t\t\t\t\t<div style={{height: \"100%\", display: \"flex\", flexDirection: \"column\", justifyContent: \"center\", alignItems: \"center\", gap: \"0.75rem\"}}>\r\n\t\t\t\t\t\t\t\t<div style={{height: 175}}><img src={SendMessage} alt=\"Send a message\"/></div>\r\n\t\t\t\t\t\t\t\t<span style={{fontWeight: 500, fontSize: \"1.25em\"}}>Your Messages</span>\r\n\t\t\t\t\t\t\t\t<span style={{color: \"#8e8e8e\", fontSize: \"0.95em\"}}>Send private photos and messages to a friend or group.</span>\r\n\t\t\t\t\t\t\t\t<button style={{width: \"initial\"}} onClick={() => setIsNewMessageBoxOpen(true)}>Send Message</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t<Route path=\"/direct/t/:roomID\"><Room roomID={roomID}/></Route>\r\n\t\t\t\t\t</Switch>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default Inbox;\r\n","import { useEffect, useState } from \"react\";\r\nimport { Route, Switch, useLocation } from \"react-router\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { Snackbar, Slide, Alert } from \"@mui/material\";\r\nimport { setUser } from \"./state/actions/currentUser\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { closeSnackbar, setSnackbar } from \"./state/actions/snackbar\";\r\n\r\nimport Navbar from \"./components/Navbar\";\r\nimport LoadingPage from \"./components/LoadingPage\";\r\n\r\nimport SignUpPage from \"./components/AccountAuth/SignUpPage\";\r\nimport PasswordReset from \"./components/AccountAuth/PasswordReset\";\r\nimport LoginPage from \"./components/AccountAuth/LoginPage\";\r\nimport AccountVerification from \"./components/AccountAuth/AccountVerification\";\r\nimport AccountEdit from \"./components/AccountEdit/AccountEdit\";\r\n\r\nimport HomePage from \"./components/HomePage\";\r\nimport UserProfile from \"./components/UserProfile\";\r\nimport newPost from \"./components/Posts/NewPost\";\r\nimport PostPage from \"./components/Posts/PostPage\";\r\n\r\nimport Inbox from \"./components/Inbox/Inbox\";\r\n\r\nimport BrokenPage from \"./components/BrokenPage\";\r\nimport \"./styles/App.css\";\r\nimport { refreshOrLogout } from \"./helpers\";\r\nimport { useHistory } from \"react-router-dom/cjs/react-router-dom.min\";\r\n\r\nconst App = () =>\r\n{\r\n\tconst dispatch = useDispatch();\r\n\tconst history = useHistory();\r\n\tconst location = useLocation();\r\n\tconst [navbarVisibility, setNavbarVisibility] = useState(true);\r\n\tconst isLoggedIn = useSelector(state => state.currentUser);\r\n\tconst isLoading = useSelector(state => state.loading);\r\n\tconst snackbar = useSelector(state => state.snackbar);\r\n\tsnackbar.handleClose = () => dispatch(closeSnackbar());\r\n\r\n\tuseEffect(() =>\r\n\t{\r\n\t\tconst url = location.pathname;\r\n\t\tif (url === \"/create/style\")\r\n\t\t\tsetNavbarVisibility(false);\r\n\t\telse setNavbarVisibility(true);\r\n\t}, [location.pathname]);\r\n\r\n\tconst checkIfLoggedIn = () =>\r\n\t{\r\n\t\tconst storedToken = localStorage.getItem(\"token\");\r\n\t\tif (storedToken !== null)\r\n\t\t{\r\n\t\t\tconst claims = jwt.decode(storedToken);\r\n\t\t\tdispatch(setUser(claims));\r\n\t\t}\r\n\t};\r\n\tuseEffect(checkIfLoggedIn, [dispatch]);\r\n\tuseEffect(() =>\r\n\t{\r\n\t\t// 5 min interval\r\n\t\tif (localStorage.token)\r\n\t\t{\r\n\t\t\tconst refreshTokenInterval = setInterval(async () => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tawait refreshOrLogout(dispatch, history);\r\n\t\t\t\t} catch(err) {\r\n\t\t\t\t\tif (err.message.includes(\"Failed to fetch\"))\r\n\t\t\t\t\t\tdispatch(setSnackbar(\"Server is down.\", \"error\"));\r\n\t\t\t\t}\r\n\t\t\t}, 4*60*1000);\r\n\t\t\treturn () => clearInterval(refreshTokenInterval);\r\n\t\t}\r\n\t}, [dispatch, history]);\r\n\r\n\treturn (\r\n\t\t<div className=\"App\" style={navbarVisibility ? { paddingTop: \"75px\" } : null}>\r\n\t\t\t{ navbarVisibility ? <Navbar/> : null }\r\n\t\t\t{\r\n\t\t\t\tisLoading\r\n\t\t\t\t\t? <Route path=\"/\" component={LoadingPage}></Route>\r\n\t\t\t\t\t: null\r\n\t\t\t}\r\n\r\n\t\t\t<Switch>\r\n\t\t\t\t<Route exact path=\"/\">\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tisLoggedIn\r\n\t\t\t\t\t\t\t? <HomePage/>\r\n\t\t\t\t\t\t\t: <LoginPage/>\r\n\t\t\t\t\t}\r\n\t\t\t\t</Route>\r\n\t\t\t\t<Route exact path=\"/accounts/email-signup\" component={SignUpPage}></Route>\r\n\t\t\t\t<Route exact path=\"/accounts/password/reset\" component={PasswordReset}></Route>\r\n\t\t\t\t<Route path=\"/accounts/verify\" component={AccountVerification}></Route>\r\n\t\t\t\t\r\n\t\t\t\t<Route exact path=\"/accounts/edit\" component={AccountEdit}></Route>\r\n\t\t\t\t<Route exact path=\"/accounts/password/change\" component={AccountEdit}></Route>\r\n\r\n\t\t\t\t<Route exact path=\"/direct/inbox\" component={Inbox}></Route>\r\n\t\t\t\t<Route exact path=\"/direct/t/:roomID\" component={Inbox}></Route>\r\n\r\n\t\t\t\t<Route exact path=\"/:username\" component={UserProfile}></Route>\r\n\t\t\t\t<Route exact path=\"/:username/saved\" component={UserProfile}></Route>\r\n\t\t\t\t<Route exact path=\"/create/style\" component={newPost}></Route>\r\n\r\n\t\t\t\t<Route exact path=\"/p/:postID\" component={PostPage}></Route>\r\n\r\n\t\t\t\t<Route path=\"/\" component={BrokenPage}/>\r\n\t\t\t</Switch>\r\n\r\n\t\t\t<Snackbar\r\n\t\t\t\topen={snackbar.open}\r\n\t\t\t\tmessage={snackbar.message}\r\n\t\t\t\tautoHideDuration={5000}\r\n\t\t\t\tonClose={snackbar.handleClose}\r\n\t\t\t\tanchorOrigin={{ vertical: \"bottom\", horizontal: \"center\" }}\r\n\t\t\t\tTransitionComponent={Slide}\r\n\t\t\t\tclassName=\"snackbar\"\r\n\t\t\t\tsx={{\r\n\t\t\t\t\t\"& .MuiAlert-message\": {\r\n\t\t\t\t\t\tfontWeight: \"bold\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"& .MuiAlert-action\": {\r\n\t\t\t\t\t\tpaddingLeft: \"4px\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<Alert onClose={snackbar.handleClose} severity={snackbar.severity} icon={false}>{snackbar.message}</Alert>\r\n\t\t\t</Snackbar>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default App;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { HashRouter as Router } from \"react-router-dom\";\r\nimport { Provider } from \"react-redux\";\r\nimport store from \"./state\";\r\nimport App from \"./App\";\r\nimport \"./styles/index.css\";\r\n\r\nReactDOM.render(\r\n\t<Router>\r\n\t\t<Provider store={store}>\r\n\t\t\t<React.StrictMode>\r\n\t\t\t\t<App />\r\n\t\t\t</React.StrictMode>\r\n\t\t</Provider>\r\n\t</Router>,\r\n\tdocument.getElementById(\"root\")\r\n);\r\n"],"sourceRoot":""}